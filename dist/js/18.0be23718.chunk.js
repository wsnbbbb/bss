(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1563:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return Pe}));a(172);var n=a(105),o=a.n(n),r=(a(152),a(78)),s=a.n(r),l=(a(175),a(66)),i=a.n(l),c=(a(47),a(17)),d=a.n(c),u=(a(60),a(12)),p=a.n(u),h=(a(98),a(55)),m=a.n(h),f=(a(254),a(116)),g=a.n(f),y=(a(255),a(133)),v=a.n(y),S=(a(173),a(84)),E=a.n(S),k=(a(1634),a(1638)),b=a.n(k),D=(a(132),a(35)),w=a.n(D),C=a(15),T=a.n(C),N=a(19),O=a.n(N),R=a(6),x=a.n(R),I=a(20),L=a.n(I),M=a(21),U=a.n(M),K=a(13),P=a.n(K),z=a(2),F=a.n(z),G=(a(58),a(11)),j=a.n(G),A=a(0),B=a.n(A),H=a(1),q=a.n(H),V=a(1596),Q=a(1592),J=a(1588),W=a(1928),X=a(1927),Y=a(1589),Z=a(1587),$=a(23),ee=a(9),te=a(28),ae=a(52),ne=(a(65),a(25)),oe=a.n(ne),re=a(33),se=a.n(re),le=(a(416),a(192)),ie=a.n(le);a(5),a(1615);function ce(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var de=ie.a.SHOW_PARENT,ue=function(e){L()(n,e);var t,a=(t=n,function(){var e,a=P()(t);if(ce()){var n=P()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return U()(this,e)});function n(e){var t;return T()(this,n),t=a.call(this,e),F()(x()(t),"onOk",(function(){t.props.onOk(t.val)})),F()(x()(t),"onClose",(function(){t.props.onClose()})),F()(x()(t),"onChange",(function(e){t.val=e})),t.val=[],t.state={sourceData:[],nowKeys:[]},t}return O()(n,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.roleData,a=e.nowData,n=[];t.forEach((function(e){n.push({title:e.rolename,value:e.id,key:e.id})}));var o={treeData:n,onChange:this.onChange,treeCheckable:!0,showCheckedStrategy:de,placeholder:"请选择角色"};return B.a.createElement(oe.a,{title:this.props.title||"请选择",visible:this.props.visible,onOk:this.onOk,onCancel:this.onClose,destroyOnClose:!0,width:"50%",okText:"确认",cancelText:"取消"},B.a.createElement(E.a,{title:"用户名称"},B.a.createElement("span",{style:{fontSize:"16px"}},a&&a.name||"")),B.a.createElement("br",null),B.a.createElement("br",null),B.a.createElement(ie.a,se()({},o,{style:{width:"100%"},defaultValue:this.props.defaultKeys})))}}]),n}(B.a.PureComponent);F()(ue,"propTypes",{data:q.a.array,title:q.a.string,visible:q.a.bool,defaultKeys:q.a.array,loading:q.a.bool,onOk:q.a.func,onClose:q.a.func});a(174);var pe,he,me,fe=a(107),ge=a.n(fe),ye=a(153);function ve(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Se,Ee,ke,be=p.a.Item,De=j.a.Option,we=ie.a.TreeNode,Ce=ie.a.SHOW_PARENT,Te=Object($.b)("root")(pe=Object($.b)("authManage")(pe=Object($.b)("pageUserstore")(pe=Object($.c)((me=he=function(e){L()(n,e);var t,a=(t=n,function(){var e,a=P()(t);if(ve()){var n=P()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return U()(this,e)});function n(e){var t;return T()(this,n),t=a.call(this,e),F()(x()(t),"onClose",(function(){t.props.onCancel()})),F()(x()(t),"getNodes",(function(e){return e.reduce((function(e,a){return e.push(B.a.createElement(we,{value:a.id,title:a.name,key:a.id,disabled:"-1"===a.id},a.children?t.getNodes(a.children):null)),e}),[])})),F()(x()(t),"reset",(function(){t.formRef.current.resetFields()})),t.formRef=B.a.createRef(),t.state={modalLoading:!1,nowData:null},t}return O()(n,[{key:"componentDidMount",value:function(){}},{key:"onFinish",value:function(e){var t=this.props.operateType;"see"!==t?"add"===t?this.props.onOk(e):this.props.edit(e):this.onClose()}},{key:"render",value:function(){var e=this,t=this.props,a=t.operateType,n=t.nowData,o=t.roleData,r=t.treenode,s=this.state.modalLoading,l=[];o.forEach((function(e){l.push({title:e.rolename,value:e.id,key:e.id})}));var i={treeData:l,treeCheckable:!0,showCheckedStrategy:Ce,placeholder:"请选择角色"};return B.a.createElement("div",null,B.a.createElement(oe.a,{title:{add:"新增",up:"修改",see:"查看"}[a],maskClosable:!1,width:"60%",destroyOnClose:!0,footer:null,onCancel:this.onClose,visible:this.props.visible,confirmLoading:s},B.a.createElement(ge.a,{tip:"Loading...",spinning:s},B.a.createElement(p.a,{name:"form_in_modal",ref:this.formRef,className:"g-modal-field",onFinish:function(t){e.onFinish(t)},initialValues:n},B.a.createElement(be,se()({label:"姓名",name:"name",rules:[{required:!0,whitespace:!0,message:"必填"},{max:8,message:"最多输入8位字符"},{min:2,message:"最少输入2位字符"}]},te.b),B.a.createElement(m.a,{placeholder:"请输入姓名",disabled:"see"===a,allowClear:!0})),"up"!=a&&B.a.createElement(be,se()({label:"登陆名",name:"loginName",rules:[{required:!0,whitespace:!0,message:"必填"},{max:16,message:"最多输入16位字符"},{min:6,message:"最少输入6位字符"}]},te.b),B.a.createElement(m.a,{placeholder:"请输入登陆账号",disabled:"see"===a,allowClear:!0})),"up"==a&&B.a.createElement(be,se()({label:B.a.createElement("span",{className:"required"},"登陆名")},te.b),B.a.createElement(m.a,{placeholder:"请输入登陆名",disabled:!0,value:n.loginName,allowClear:!0})),B.a.createElement(be,se()({label:"部门",name:"depts",rules:[{required:!0,message:"必填"}]},te.b),B.a.createElement(ie.a,{showSearch:!0,style:{width:"100%"},placeholder:"请选择部门",allowClear:!0,multiple:!0,treeDefaultExpandedKeys:["1"],onChange:this.handleChange,disabled:"see"===a},this.getNodes(r))),B.a.createElement(be,se()({label:"密码",name:"password",rules:"add"===a?[{required:!0,whitespace:!0,message:"必填"},{min:6,message:"最少输入6位字符"},{max:16,message:"最多输入16位字符"}]:null},te.b),B.a.createElement(m.a,{type:"password",placeholder:"add"===a?"请输入密码":"密码不为空,则可选填",disabled:"see"===a,allowClear:!0})),B.a.createElement(be,se()({label:"手机号",name:"mobile"},te.b,{rules:[{required:!0,pattern:ye.a.mobile,message:"请输入正确手机号"}]}),B.a.createElement(m.a,{placeholder:"请输入手机号",disabled:"see"===a,allowClear:!0})),B.a.createElement(be,se()({label:"邮箱",name:"email"},te.b,{rules:[{pattern:ye.a.isEmail,message:"请输入正确邮箱"}]}),B.a.createElement(m.a,{placeholder:"请输入邮箱地址",disabled:"see"===a,allowClear:!0})),B.a.createElement(be,se()({label:"工号",name:"workNumber",rules:[{max:10,message:"最多输入10个字符"}]},te.b),B.a.createElement(m.a,{rows:4,disabled:"see"===a,placeholder:"请输入描述",allowClear:!0})),B.a.createElement(be,se()({label:"角色",name:"roles"},te.b),B.a.createElement(ie.a,se()({},i,{disabled:"see"===a}))),B.a.createElement(be,se()({label:"状态",name:"status"},te.b,{rules:[{required:!0,message:"请选择状态"}],style:"up"===a?{display:"none"}:{display:"flex"}}),B.a.createElement(j.a,{disabled:"see"===a},B.a.createElement(De,{key:1,value:1},"启用"),B.a.createElement(De,{key:0,value:0},"禁用"))),B.a.createElement("div",{className:"actions-btn"},B.a.createElement(d.a,{htmlType:"submit",className:"action-btn ok",style:"see"===a?{display:"none"}:{display:"inline-block"}},"提交"),B.a.createElement(d.a,{htmlType:"reset",className:"action-btn ok",style:"see"===a?{display:"none"}:{display:"inline-block"},onClick:this.reset},"重置"),B.a.createElement(d.a,{onClick:this.onClose,className:"action-btn ok"},"取消"))))))}}]),n}(B.a.Component),F()(he,"propTypes",{location:q.a.any,history:q.a.any,userinfo:q.a.any,powers:q.a.array}),pe=me))||pe)||pe)||pe)||pe,Ne=a(1636);function Oe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Re,xe,Ie,Le=ie.a.TreeNode,Me=Object($.b)("authManage")(Se=Object($.c)((ke=Ee=function(e){L()(n,e);var t,a=(t=n,function(){var e,a=P()(t);if(Oe()){var n=P()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return U()(this,e)});function n(e){var t;return T()(this,n),t=a.call(this,e),F()(x()(t),"onOk",(function(){t.props.onOk(t.selectedKeys)})),F()(x()(t),"onClose",(function(){t.props.onClose()})),F()(x()(t),"handleChange",(function(e){t.selectedKeys=e})),F()(x()(t),"searchUser",(function(e){})),F()(x()(t),"getNodes",(function(e){return e.reduce((function(e,a){return e.push(B.a.createElement(Le,{value:a.id,title:a.name,key:a.id},a.children?t.getNodes(a.children):null)),e}),[])})),t.selectedKeys=[],t.state={nowKeys:[],loading:!1,defaultKeys:t.props.defaultKeys},t}return O()(n,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.defaultKeys,a=e.visible,n=e.title,o=e.treenode,r=e.nowData;return B.a.createElement(oe.a,{title:n,visible:a,destroyOnClose:!0,onOk:this.onOk,onCancel:this.onClose,okText:"确认",cancelText:"取消",width:"50%"},B.a.createElement(E.a,{title:"角色名称"},B.a.createElement("span",null,r&&r.name||"")),B.a.createElement("br",null),B.a.createElement("br",null),B.a.createElement(ie.a,{showSearch:!0,style:{width:"100%"},placeholder:"请选择部门",allowClear:!0,multiple:!0,treeDefaultExpandAll:!0,onChange:this.handleChange,defaultValue:t},this.getNodes(o)))}}]),n}(B.a.PureComponent),F()(Ee,"propTypes",{data:q.a.array,title:q.a.string,visible:q.a.bool,defaultKeys:q.a.array,loading:q.a.bool,onOk:q.a.func,onClose:q.a.func,record:q.a.object}),Se=ke))||Se)||Se,_e=a(18);function Ue(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Ke=j.a.Option,Pe=Object($.b)("root")(Re=Object($.b)("authManage")(Re=Object($.b)("pageUserstore")(Re=Object($.c)((Ie=xe=function(e){L()(n,e);var t,a=(t=n,function(){var e,a=P()(t);if(Ue()){var n=P()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return U()(this,e)});function n(e){var t;return T()(this,n),t=a.call(this,e),F()(x()(t),"onReset",(function(){t.searchFormRef.current.resetFields()})),F()(x()(t),"onPageChange",(function(e,a){t.onGetListData({deptId:t.state.orgTreeDefault,page:e,pageSize:a})})),F()(x()(t),"onPageSizeChange",(function(e,a){t.onGetListData({deptId:t.state.orgTreeDefault,page:e,pageSize:a})})),F()(x()(t),"getHead",(function(){var e="";e=void 0===t.key?"1":t.key[0],_e.a.get("".concat(BSS_ADMIN_URL,"/api/user/dept/managerbydept?dept_id=").concat(e)).then((function(e){2e4===e.data.code&&t.setState({head:e.data.data}),t.setState({loading:!1})})).catch((function(e){t.setState({loading:!1})}))})),F()(x()(t),"set",(function(e){var a=e.id,n="";n=void 0===t.key?"1":t.key[0];var o={};o.userId=a,o.deptId=n,o.hasHead=1,_e.a.put("".concat(BSS_ADMIN_URL,"/api/user/manage/dept/head"),ee.a.clearEmpty(o)).then((function(e){2e4===(e=e.data).code?(t.getHead(),w.a.success("设置成功")):ee.a.dealFail(e)})).catch((function(){}))})),F()(x()(t),"Noset",(function(e){var a=e.id,n="";n=void 0===t.key?"1":t.key[0];var o={};o.userId=a,o.deptId=n,o.hasHead=0,_e.a.put("".concat(BSS_ADMIN_URL,"/api/user/manage/dept/head"),ee.a.clearEmpty(o)).then((function(e){2e4===(e=e.data).code?(t.getHead(),w.a.success("取消成功")):ee.a.dealFail(e)})).catch((function(){}))})),F()(x()(t),"changeStatus",(function(e,a){var n=a.status;n=0===e?1:0,t.setState({loading:!0}),t.props.authManage.setUseStatus(a.id,{status:n,version:a.version}).then((function(e){2e4===e.code?(t.onClose(),t.onGetListData({deptId:t.state.orgTreeDefault,page:1}),w.a.success("修改状态成功"),t.setState({loading:!1})):(w.a.error(e.data),t.setState({modalLoading:!1,loading:!1})),t.setState({modalLoading:!1,loading:!1})})).catch((function(){t.setState({modalLoading:!1})}))})),F()(x()(t),"onRoleClose",(function(){t.setState({roleTreeShow:!1})})),F()(x()(t),"upUserLists",(function(){t.setState({loading:!0}),_e.a.get("".concat(BSS_ADMIN_URL,"/api/user/manage/down")).then((function(e){2e4===(e=e.data).code?(t.onGetListData(t.state.page,t.state.pageSize),w.a.success("更新用户列表成功")):w.a.error("更新用户列表失败"),t.setState({loading:!1})})).catch((function(){t.setState({loading:!1})}))})),F()(x()(t),"onOk",(function(e){t.props.authManage.addUser(e).then((function(e){2e4===e.code?(t.onClose(),t.onGetListData({deptId:t.state.orgTreeDefault,page:1}),w.a.success("添加成功")):(w.a.error(e.data),t.setState({modalLoading:!1})),t.setState({modalLoading:!1})})).catch((function(){t.setState({modalLoading:!1})}))})),F()(x()(t),"onOk2",(function(e){var a=t.state.nowData;e.version=a.version,t.setState({loading:!0}),t.props.authManage.upUser(a.id,e).then((function(e){t.onClose(),2e4===e.code?(t.onGetListData({deptId:t.state.orgTreeDefault,page:1}),t.setState({loading:!1}),w.a.success("修改成功")):(t.onClose(),w.a.error(e.data),t.setState({modalLoading:!1}))})).catch((function(){t.setState({modalLoading:!1})}))})),F()(x()(t),"onOk3",(function(e){var a=t.state.nowData;t.setState({loading:!0}),t.props.authManage.setUserRoles(a.id,{roles:e,version:t.state.roleVersion}).then((function(e){2e4===e.code?(t.setState({roleTreeShow:!1,loading:!1}),t.onGetListData({deptId:t.state.orgTreeDefault,page:1}),w.a.success("分配角色成功")):(t.setState({roleTreeShow:!1,loading:!1}),t.onClose(),w.a.error(e.data)),t.setState({roleTreeShow:!1,loading:!1})})).catch((function(){t.setState({roleTreeShow:!1,loading:!1})}))})),F()(x()(t),"onClose",(function(){t.setState({modalShow:!1})})),F()(x()(t),"edit",(function(e){t.onOk2(e)})),F()(x()(t),"handleCancel3",(function(){t.setState({defDeptShow:!1,defDeptDefault:[]})})),F()(x()(t),"handleOk3",(function(e){var a=t.state.nowData;t.props.authManage.upUser(a.id,{depts:e,loginName:a.loginName,name:a.name,mobile:a.mobile,status:a.status}).then((function(e){2e4===e.code?(t.setState({defDeptShow:!1}),t.onGetListData({deptId:t.state.orgTreeDefault,page:1}),w.a.success("修改成功")):(w.a.error(e.data),t.setState({defDeptShow:!1}),t.setState({modalLoading:!1})),t.setState({modalLoading:!1})})).catch((function(){t.setState({modalLoading:!1})}))})),F()(x()(t),"onCancel",(function(){t.setState({modalShow:!1})})),t.searchFormRef=B.a.createRef(),t.searchCondition={},t.state={lists:[],roleData:[],operateType:"add",loading:!1,modalLoading:!1,modalShow:!1,nowData:{},selectedOrgId:null,roleTreeShow:!1,roleTreeDefault:[],orgTreeDefault:te.h.key,page:1,pageSize:20,total:0,treeLoading:!1,treeOnOkLoading:!1,defDeptShow:!1,treenode:[],defDeptDefault:[],type:"user",roleVersion:0,head:{}},t}return O()(n,[{key:"componentDidMount",value:function(){this.onGetListData({deptId:1}),this.onGetRoleTreeData(),this.getOrgData(),this.getHead()}},{key:"onGetRoleTreeData",value:function(){var e=this;this.props.authManage.getRoles({pageSize:200}).then((function(t){2e4===t.code&&e.setState({roleData:t.data.records})}))}},{key:"onGetListData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=_.assign({},this.searchCondition,t);this.setState({loading:!0}),this.props.authManage.getUserList(ee.a.clearEmpty(a)).then((function(t){2e4===t.code?e.setState({lists:t.data.records,total:t.data.total,page:t.data.current,pageSize:t.data.size}):w.a.error(t.message),e.setState({loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"onSearch",value:function(e){this.searchCondition=e,this.onGetListData({deptId:this.state.orgTreeDefault,page:1})}},{key:"getRolebyOrg",value:function(e){this.key=[],this.key.push(e),this.setState({orgTreeDefault:e,page:1,searchParam:{}}),this.onGetListData({page:1,deptId:e}),this.getHead()}},{key:"onModalShow",value:function(e,t){var a=this;if("add"===e)return this.getOrgData(),void this.setState({operateType:e,nowData:{depts:void 0===this.key?["1"]:this.key},modalShow:!0});this.props.authManage.getUser(t.id).then((function(t){if(2e4===t.code){var n=[],o=[];t.data.depts.forEach((function(e){n.push(e.id)})),t.data.roles.forEach((function(e){o.push(e.id)})),a.setState({nowData:F()({id:t.data.id,depts:n,version:t.data.version,roles:o,name:t.data.name,mobile:t.data.mobile,email:t.data.email,workNumber:t.data.workNumber,loginName:t.data.loginName,status:t.data.status},"roles",o),modalShow:!0,operateType:e})}else w.a.error(t.data)})).catch((function(){w.a.error(res.data)}))}},{key:"onDel",value:function(e){var t=this;this.setState({loading:!0}),this.props.authManage.delUser(e).then((function(e){2e4===e.code?(t.onGetListData({deptId:t.state.orgTreeDefault,page:1}),t.setState({loading:!1}),w.a.success("删除成功")):(w.a.error(e.data),t.setState({loading:!1}))})).catch((function(){t.setState({loading:!1})}))}},{key:"getOrgData",value:function(){var e=this;this.setState({loading:!0}),_e.a.get("".concat(BSS_ADMIN_URL,"/api/user/dept")).then((function(t){2e4===t.data.code&&e.setState({treenode:ee.a.formatTree(t.data.data)}),e.setState({loading:!1})})).catch((function(t){e.setState({loading:!1})}))}},{key:"onTreeShowClick",value:function(e){var t=this;this.props.authManage.getUser(e.id).then((function(a){if(2e4===a.code){var n=[];a.data.roles.forEach((function(e){n.push(e.id)})),t.setState({nowData:e,roleTreeDefault:n,roleVersion:a.data.version,roleTreeShow:!0})}else w.a.error(a.data)})).catch((function(){w.a.error(res.data)}))}},{key:"onDefDeptShow",value:function(e){var t=this;this.props.authManage.getUser(e.id).then((function(a){if(2e4===a.code){var n=[];a.data.depts.forEach((function(e){n.push(e.id)})),t.setState({nowData:e,defDeptDefault:n,deptVersion:a.data.version,defDeptShow:!0})}else w.a.error(a.data)})).catch((function(){w.a.error(res.data)}))}},{key:"makeColumns",value:function(){var e=this,t=ae.a.getPermission()||[];return[{title:"用户名",dataIndex:"name",key:"name"},{title:"账号",dataIndex:"loginName",key:"loginName"},{title:"手机号",dataIndex:"mobile",key:"mobile"},{title:"邮箱",dataIndex:"email",key:"email"},{title:"工号",dataIndex:"workNumber",key:"workNumber"},{title:"状态",dataIndex:"status",key:"status",render:function(a,n){return 1===a?B.a.createElement(b.a,{defaultChecked:!0,onChange:function(){return e.changeStatus(a,n)},disabled:!t.includes("user-edit")}):B.a.createElement(b.a,{onChange:function(){return e.changeStatus(a,n)},disabled:!t.includes("user-edit")})}},{title:"操作",key:"control",fixed:"right",width:240,render:function(a,n){var o=e.state,r=(o.head,o.lists,[]);t.includes("user-view")&&r.push(B.a.createElement("span",{key:"0",className:"control-btn green",onClick:function(){return e.onModalShow("see",n)}},B.a.createElement(E.a,{placement:"top",title:"查看"},B.a.createElement(V.a,{style:{color:"#1890ff"}})))),t.includes("user-edit")&&r.push(B.a.createElement("span",{key:"1",className:"control-btn blue",onClick:function(){return e.onModalShow("up",n)}},B.a.createElement(E.a,{placement:"top",title:"修改"},B.a.createElement(Q.a,{style:{color:"#1890ff"}})))),t.includes("user-edit")&&r.push(B.a.createElement("span",{key:"2",className:"control-btn blue",onClick:function(){return e.onTreeShowClick(n)}},B.a.createElement(E.a,{placement:"top",title:"分配角色"},B.a.createElement(J.a,{style:{color:"#1890ff"}})))),t.includes("user-edit")&&r.push(B.a.createElement(v.a,{key:"3",title:"确定要设置 ".concat(n.name," 为主管吗?"),onConfirm:function(){return e.set(n)},okText:"确定",cancelText:"取消"},B.a.createElement("span",{className:"control-btn red"},B.a.createElement(E.a,{placement:"top",title:"设置主管"},B.a.createElement(W.a,null))))),t.includes("user-edit")&&r.push(B.a.createElement(v.a,{key:"4",title:"确定要取消 ".concat(n.name," 为主管吗?"),onConfirm:function(){return e.Noset(n)},okText:"确定",cancelText:"取消"},B.a.createElement("span",{className:"control-btn red"},B.a.createElement(E.a,{placement:"top",title:"取消主管"},B.a.createElement(X.a,null))))),t.includes("user-delete")&&r.push(B.a.createElement(v.a,{key:"5",title:"确定删除吗?",onConfirm:function(){return e.onDel(n.id)},okText:"确定",cancelText:"取消"},B.a.createElement("span",{className:"control-btn red"},B.a.createElement(E.a,{placement:"top",title:"删除"},B.a.createElement(Y.a,{style:{color:"red"}})))));var s=[];return r.forEach((function(e,t){t&&s.push(B.a.createElement(g.a,{key:"line".concat(t),type:"vertical"})),s.push(e)})),s}}]}},{key:"render",value:function(){var e=this,t=(this.props.root.powers,this.state),a=t.lists,n=t.loading,r=t.page,l=t.pageSize,c=t.total,u=t.roleData,h=t.defDeptDefault,f=t.treenode,g=t.head,y=ae.a.getPermission()||[];return B.a.createElement("main",{className:"mian"},B.a.createElement("div",{className:"left-contain"},B.a.createElement(Ne.a,{selectedOrgId:this.state.selectedOrgId,type2:this.state.type,onQuery:function(t,a){e.getRolebyOrg(t,a)}})),B.a.createElement("div",{className:"right-contain"},B.a.createElement("div",{className:"clearfix"},B.a.createElement("div",{className:"c-search",style:{float:"left"}},B.a.createElement(p.a,{ref:this.searchFormRef,name:"horizontal_login",layout:"inline",onFinish:function(t){e.onSearch(t)}},B.a.createElement(p.a.Item,{name:"name",rules:[{whiteSpace:!0,message:"不能输入空格"},{pattern:ye.a.isNormalEncode,message:"不能输入特殊字符"}]},B.a.createElement(m.a,{placeholder:"姓名",allowClear:!0})),B.a.createElement(p.a.Item,{name:"loginName",rules:[{whiteSpace:!0,message:"不能输入空格"},{pattern:ye.a.isNormalEncode,message:"不能输入特殊字符"}]},B.a.createElement(m.a,{placeholder:"登陆账号",allowClear:!0})),B.a.createElement(p.a.Item,{name:"status"},B.a.createElement(j.a,{style:{width:"160px"},placeholder:"状态",allowClear:!0},B.a.createElement(Ke,{value:1},"启用"),B.a.createElement(Ke,{value:0},"禁用"))),B.a.createElement(p.a.Item,{shouldUpdate:!0},B.a.createElement(d.a,{type:"primary",htmlType:"submit"},"搜索")),B.a.createElement(p.a.Item,{shouldUpdate:!0},B.a.createElement(d.a,{type:"primary",htmlType:"reset",onClick:this.onReset},"重置")))),B.a.createElement("div",{className:"c-operate",style:{float:"right"}},y.includes("user-add")&&B.a.createElement(d.a,{size:"middle",onClick:function(){e.onModalShow("add",f.id)},style:{marginRight:"50px",color:"#1890ff",borderColor:"#1890ff"},icon:B.a.createElement(Z.a,null)},"增加员工"),y.includes("user-down")&&B.a.createElement(d.a,{size:"middle",onClick:this.upUserLists,style:{color:"#1890ff",borderColor:"#1890ff"}},"与钉钉同步"))),B.a.createElement("div",{className:"head"},B.a.createElement("p",null,"部门主管：",B.a.createElement(i.a,{color:"blue"},g.name))),B.a.createElement("div",{className:"g-table"},B.a.createElement(s.a,{columns:this.makeColumns(),rowKey:function(e){return e.id},loading:n,dataSource:a,pagination:!1,scroll:{y:800}}),B.a.createElement(o.a,{className:"g-pagination",current:r,total:c,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e){return"一共".concat(e,"条数据")},defaultPageSize:l,onChange:function(t,a){e.onPageChange(t,a)},onShowSizeChange:function(t,a){e.onPageSizeChange(t,a)}})),B.a.createElement(Te,{nowData:this.state.nowData,visible:this.state.modalShow,operateType:this.state.operateType,roleData:u,onOk:this.onOk,edit:this.edit,treenode:f,onCancel:this.onCancel,loading:n}),B.a.createElement(ue,{title:"分配角色",roleData:u,visible:this.state.roleTreeShow,defaultKeys:this.state.roleTreeDefault,onOk:this.onOk3,onClose:this.onRoleClose,loading:n,nowData:this.state.nowData}),B.a.createElement(Me,{title:"修改部门",nowData:this.state.nowData,visible:this.state.defDeptShow,defaultKeys:h,onOk:this.handleOk3,onClose:this.handleCancel3,treenode:f,loading:n})))}}]),n}(B.a.Component),F()(xe,"propTypes",{location:q.a.any,history:q.a.any,userinfo:q.a.any,powers:q.a.array}),Re=Ie))||Re)||Re)||Re)||Re},1615:function(e,t,a){},1636:function(e,t,a){"use strict";a(47);var n,o,r,s=a(17),l=a.n(s),i=a(33),c=a.n(i),d=(a(98),a(55)),u=a.n(d),p=(a(174),a(107)),h=a.n(p),m=(a(419),a(421)),f=a.n(m),g=(a(420),a(188)),y=a.n(g),v=(a(132),a(35)),S=a.n(v),E=a(15),k=a.n(E),b=a(19),D=a.n(b),w=a(6),C=a.n(w),T=a(20),N=a.n(T),O=a(21),R=a.n(O),x=a(13),I=a.n(x),L=a(2),M=a.n(L),_=(a(65),a(25)),U=a.n(_),K=(a(60),a(12)),P=a.n(K),z=a(0),F=a.n(z),G=a(1),j=a.n(G),A=a(23),B=a(5),H=a.n(B),q=a(18),V=a(9),Q=a(1591),J=a(1716),W=a(1921),X=a(1918),Y=(a(1637),a(28)),Z=a(52);function $(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var ee=P.a.Item,te=U.a.confirm,ae=Z.a.getPermission()||[],ne=Object(A.b)("root")(n=Object(A.b)("authManage")(n=Object(A.c)((r=o=function(e){N()(n,e);var t,a=(t=n,function(){var e,a=I()(t);if($()){var n=I()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return R()(this,e)});function n(e){var t;return k()(this,n),t=a.call(this,e),M()(C()(t),"reset",(function(){t.formRef.current.resetFields()})),M()(C()(t),"onClose",(function(){t.setState({showmodal:!1})})),M()(C()(t),"onFinish",(function(e){var a=t.state.operateType;if("see"!==a)if("add"===a)e.parId=t.key,t.setState({loading:!0}),q.a.post("".concat(BSS_ADMIN_URL,"/api/user/dept/add"),e).then((function(e){2e4==e.data.code?(t.onClose(),t.getOrgData(),S.a.success("新建机构成功"),t.setState({loading:!1})):(S.a.error(e.data.data),t.setState({loading:!1}))})).catch((function(e){S.a.error(e.data.data),t.setState({loading:!1})}));else{var n=t.node.id;e.parId=t.node.parId,e.version=t.state.version,t.setState({loading:!0}),q.a.put("".concat(BSS_ADMIN_URL,"/api/user/dept/").concat(n,"/update"),e).then((function(e){2e4==e.data.code?(t.getOrgData(),t.onClose(),S.a.success("修改机构成功"),t.setState({loading:!1})):(S.a.error(e.data.data),t.setState({loading:!1}))})).catch((function(e){S.a.error(e.data.data),t.setState({loading:!1})}))}else t.onClose()})),t.formRef=F.a.createRef(),t.key=[],t.nowDataKey=t.props.nowDataKey||Y.h.id,t.state={loading:!1,nowDataKey:t.props.nowDataKey||Y.h.id,showmodal:!1,modalLoading:!1,operateType:"see",treenode:[],listnode:[],nowData:{},listnode2:[],version:0,expand:[]},t}return D()(n,[{key:"componentDidMount",value:function(){this.getOrgData()}},{key:"getOrgData",value:function(){var e=this;if(this.setState({loading:!0}),"role"===this.props.type2){var t=H.a.assign({},{otherDept:0});this.props.authManage.getDeptLists(t).then((function(t){2e4==t.code&&e.setState({treenode:V.a.formatTree(t.data),listnode2:t.data}),e.setState({loading:!1})})).catch((function(t){e.setState({loading:!1})}))}else q.a.get("".concat(BSS_ADMIN_URL,"/api/user/dept")).then((function(t){2e4==t.data.code&&e.setState({treenode:V.a.formatTree(t.data.data),listnode:t.data.data}),e.setState({loading:!1})})).catch((function(t){e.setState({loading:!1})}))}},{key:"opt",value:function(e,t,a){this.node=t,this.key=e,this.setState({operateType:a,showmodal:!0,nowData:{id:t.id||"",name:t.name||""},version:t&&t.version})}},{key:"onDelOrg",value:function(e,t){this.props.type2;var a=this;te({title:"你确定要删除这个部门吗?",icon:F.a.createElement(Q.a,null),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){a.setState({loading:!0}),q.a.delete("".concat(BSS_ADMIN_URL,"/api/user/dept/").concat(e,"/delete")).then((function(e){2e4===e.data.code?(a.onClose(),S.a.success("删除成功"),a.getOrgData(),a.setState({loading:!1})):(S.a.error(e.data.data),a.setState({loading:!1}))})).catch((function(){a.setState({loading:!1}),S.a.error(res.data.data)}))},onCancel:function(){}})}},{key:"handleTreeState",value:function(e,t,a,n){if(event.preventDefault(),e.stopPropagation(),"current"===n){if(this.nowDataKey==t)return!1;var o=a.id===t;this.nowDataKey=o?t:this.nowDataKey,this.setState({nowDataKey:this.nowDataKey}),this.props.onQuery(t,a)}else if("role"===this.props.type2){var r=H.a.cloneDeep(this.state.listnode2),s=H.a.map(r,(function(e){return e.id===t?(e.isexpanded=null!=e.isexpanded&&!e.isexpanded,e):e}));this.setState({listnode2:s,treenode:V.a.formatTree(s)})}else{var l=H.a.cloneDeep(this.state.listnode),i=H.a.map(l,(function(e){return e.id===t?(e.isexpanded=null==e.isexpanded||!e.isexpanded,e):e}));this.setState({listnode:i,treenode:V.a.formatTree(i)})}}},{key:"makeTreeNode",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n="tree-node",o=e.children&&e.children.length>0;(void 0===e.isexpanded&&"0"==e.parId||e.isexpanded)&&(n+=" is-expanded"),this.state.nowDataKey==e.id&&(n+=" is-current");var r=F.a.createElement(y.a,{style:{width:"80px",textAlign:"center"}},F.a.createElement(y.a.Item,{key:"role"===this.props.type2?"1":"2",onClick:function(){t.opt(e.id,e,"see")}},F.a.createElement("span",null,"查看")),ae.includes("dept-add")&&F.a.createElement(y.a.Item,{key:"role"===this.props.type2?"3":"4",onClick:function(){t.opt(e.id,e,"add")}},F.a.createElement("span",null,"增加")),ae.includes("dept-edit")&&F.a.createElement(y.a.Item,{key:"role"===this.props.type2?"5":"6",onClick:function(){t.opt(e.id,e,"up")}},F.a.createElement("span",null,"修改")),ae.includes("dept-delete")&&F.a.createElement(y.a.Item,{key:"role"===this.props.type2?"7":"8",onClick:function(){t.onDelOrg(e.id,"delet")}},F.a.createElement("span",{style:{textAlign:"center"}},"删除")));return F.a.createElement("div",{role:"treeitem",className:n,key:e.id},F.a.createElement("div",{className:"tree-node_content is-focusable",style:{paddingLeft:16*a}},F.a.createElement("div",{className:"node-data"},F.a.createElement("span",{className:"node-label",onClick:function(a){t.handleTreeState(a,e.id,e,"expanded")}},(o&&!0===e.isexpanded||o&&void 0===e.isexpanded&&"0"==e.parId)&&F.a.createElement(J.a,{className:"expaned-icon"}),(o&&!1===e.isexpanded||o&&void 0===e.isexpanded&&"0"!=e.parId)&&F.a.createElement(W.a,{className:"expaned-icon"})),F.a.createElement("span",{id:e.id,onClick:function(a){t.handleTreeState(a,e.id,e,"current")},className:"node-label"},e.name),F.a.createElement("div",{className:"node-lable-opt"},F.a.createElement(f.a.Button,{disabled:"-1"===e.id,overlay:r,style:{top:"13px"},icon:F.a.createElement(X.a,{style:{color:"#3e82de",fontSize:"18px"}}),type:"link",placement:"bottomCenter"})))),o&&F.a.createElement("div",{role:"group",className:"tree-node_children",key:e.id},H.a.map(e.children,(function(e){return t.makeTreeNode(e,a+1)}))))}},{key:"render",value:function(){var e=this,t=this.state.treenode,a=this.state,n=a.operateType,o=a.loading,r=a.showmodal,s=a.modalLoading,i=a.nowData;return F.a.createElement(F.a.Fragment,null,o&&F.a.createElement(h.a,null),F.a.createElement("div",{className:"org-tree tree--highlight-current",role:"tree"},H.a.map(t,(function(t){return e.makeTreeNode(t)}))),F.a.createElement(U.a,{title:{add:"新增部门",up:"修改部门",see:"查看"}[n],maskClosable:!0,width:"50%",destroyOnClose:!0,onCancel:function(){e.onClose()},visible:r,confirmLoading:s,footer:null},F.a.createElement(P.a,{name:"form_in_modal",ref:this.formRef,initialValues:"add"===n?null:i,onFinish:function(t){e.onFinish(t)},className:"g-modal-field"},F.a.createElement(ee,c()({label:"部门名称",name:"name",rules:[{required:!0,message:"必填"},{max:16,message:"最多输入16位字符"}]},Y.b),F.a.createElement(u.a,{placeholder:"请输入部门名称",disabled:"see"===n})),F.a.createElement("div",{className:"actions-btn"},F.a.createElement(l.a,{htmlType:"submit",className:"action-btn ok",style:"see"===n?{display:"none"}:{display:"inline-block"}},"提交"),F.a.createElement(l.a,{htmlType:"reset",className:"action-btn ok",onClick:this.reset,style:"see"===n?{display:"none"}:{display:"inline-block"}},"重置"),F.a.createElement(l.a,{onClick:this.onClose,className:"action-btn ok"},"取消")))))}}]),n}(F.a.Component),M()(o,"propTypes",{onQuery:j.a.func,selectedOrgId:j.a.string}),n=r))||n)||n)||n;t.a=ne},1637:function(e,t,a){}}]);