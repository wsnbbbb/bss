(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{1575:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return le}));a(172);var n,r,o,s,i,c,l,u=a(105),d=a.n(u),p=(a(152),a(78)),m=a.n(p),h=(a(98),a(55)),y=a.n(h),f=(a(47),a(17)),v=a.n(f),g=a(15),k=a.n(g),S=a(19),b=a.n(S),w=a(6),C=a.n(w),D=a(20),E=a.n(D),I=a(21),O=a.n(I),R=a(13),N=a.n(R),j=a(2),M=a.n(j),z=(a(65),a(25)),x=a.n(z),_=(a(60),a(12)),P=a.n(_),L=(a(58),a(11)),T=a.n(L),G=a(0),F=a.n(G),U=a(1),K=a.n(U),B=a(23),A=a(9),q=a(52),J=(a(71),a(5)),Q=a.n(J),V=a(18),W=(a(416),a(192)),H=a.n(W),X=a(1591),Y=a(99),Z=(a(3),a(28),a(153),a(26));function $(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ee(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}P.a.Item,y.a.TextArea;var te,ae,ne,re=T.a.Option,oe=(H.a.TreeNode,x.a.confirm),se=(n=Object(B.b)("root"),r=Object(B.b)("cabinetDict"),o=Object(B.b)("serverDict"),s=Object(B.b)("deviceDict"),Object(Y.g)(i=n(i=r(i=o(i=s(i=Object(B.c)((l=c=function(e){E()(n,e);var t,a=(t=n,function(){var e,a=N()(t);if(ee()){var n=N()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return O()(this,e)});function n(e){var t;return k()(this,n),t=a.call(this,e),M()(C()(t),"onReset",(function(){t.searchFormRef.current.resetFields()})),M()(C()(t),"onClose",(function(){t.setState({showModal:!1})})),M()(C()(t),"selectedRow",(function(e,a){t.setState({selectedRowKeys:e})})),M()(C()(t),"showAddConfirm",(function(){var e=t.state.selectedRowKeys,a=C()(t);if(e.length<1)return x.a.warning({title:"提示",content:"请选择至少一条数据！",destroyOnClose:!0}),!1;oe({title:"你确定要批量关联到子模板吗？",icon:F.a.createElement(X.a,null),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){a.onModelOk(e),a.setState({selectedRowKeys:[]})},onCancel:function(){}})})),M()(C()(t),"onModelOk",(function(e){t.setState({loading:!0}),V.a.post("".concat(BSS_ADMIN_URL,"/api/old/moban/relation/").concat(t.props.record.id,"/add"),e).then((function(e){2e4===(e=e.data).code?(t.onGetMListData({page:1,inServer:!0}),A.a.auto_close_result("ok","操作成功")):(A.a.dealFail(e),t.setState({loading:!1}))})).catch((function(){t.setState({loading:!1})}))})),t.selectedRowKeys=[],t.searchFormRef=F.a.createRef(),t.searchCondition={},t.state={lists:[],loading:!1,showModal:!1,pageNum:1,page_size:20,total:0,pages:0,selectedRowKeys:[]},t}return b()(n,[{key:"componentDidMount",value:function(){}},{key:"onGetMListData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Q.a.assign({},this.searchCondition,{childId:this.props.record.id},t);this.setState({loading:!0}),V.a.get("".concat(BSS_ADMIN_URL,"/api/old/moban/relation"),{params:A.a.clearEmpty(a)}).then((function(t){if(t=t.data,A.a.hasStatusOk(t)){var a=t.data.records;e.setState({lists:a,total:t.data.total,pages:t.data.pages,pageNum:t.data.current,selectedRowKeys:[]})}else A.a.dealFail(t);e.setState({loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"modalShow",value:function(){this.searchCondition={},"see"===this.props.type?this.onGetMListData():this.onGetMListData({inServer:!0}),Object.keys(this.props.serverDict.server_model).length<=0&&this.props.serverDict.fetchServerModel(),Object.keys(this.props.serverDict.server_brand).length<=0&&this.props.serverDict.fetchServerBrand(),this.setState({showModal:!0})}},{key:"onSearch",value:function(e){this.searchCondition=e;var t=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$(Object(a),!0).forEach((function(t){M()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e,{inServer:!0});"see"===this.props.type?this.onGetMListData(e):this.onGetMListData(t)}},{key:"makeColumns",value:function(){var e=this.props.serverDict.server_brand,t=this.props.serverDict.server_model;return[{title:"服务器类型",dataIndex:"serverType",key:"serverType",width:120,render:function(e,t){return Z.j.se_unittype[e]||"未知类型"}},{title:"服务器名称",dataIndex:"serverName",key:"serverName",render:function(a,n){var r=t[n.serverModel]||void 0,o=e[n.serverBrand]||void 0;return"".concat(o,"_").concat(r,"_").concat(n.serverSpec)}},{title:"管理IP",dataIndex:"serverIp",key:"serverIp"},{title:"品牌",dataIndex:"serverBrand",key:"serverBrand",render:function(t,a){return t?(t=parseInt(t),e[t]):""}},{title:"型号",dataIndex:"serverModel",key:"serverModel",render:function(e,a){return e?(e=parseInt(e),t[e]):""}},{title:"规格",dataIndex:"serverSpec",key:"serverSpec"},{title:"CPU",dataIndex:"serverCpu",key:"serverCpu",render:function(e,t){return t.serverCpu&&t.serverCpu.cpuName}},{title:"内存",dataIndex:"serverCurrentMemory",key:"serverCurrentMemory"},{title:"硬盘",dataIndex:"serverCurrentDisk",key:"serverCurrentDisk"},{title:"网卡",dataIndex:"networkNumber",key:"networkNumber"},{title:"销售状态",dataIndex:"status",key:"status",render:function(e){return A.a.renderStatus(Z.j.market,e)}},{title:"发布状态",dataIndex:"releaseStatus",key:"releaseStatus",render:function(e,t){return Z.j.releaseStatus[e]||"unknow"}},{title:"资源备注",dataIndex:"remark",key:"remark"}]}},{key:"render",value:function(){var e=this,t=this.state,a=t.lists,n=t.showModal,r=t.loading,o=t.total,s=t.page_size,i=t.pageNum,c=this.props,l=c.type,u=(c.record,{current:i,total:o,size:s,defaultPageSize:s,onChange:function(t,a){return"see"===l?e.onGetMListData({page:t,pageSize:a}):e.onGetMListData({page:t,pageSize:a,inServer:!0})},onShowSizeChange:function(t,a){return"see"===l?e.onGetMListData({page:t,pageSize:a}):e.onGetMListData({page:t,pageSize:a,inServer:!0})},showTotal:function(e){return"一共".concat(e,"条数据")}});return F.a.createElement("main",{style:{float:"left"}},F.a.createElement(x.a,{title:"see"===l?"查看服务器":"关联服务器",maskClosable:!1,width:"80%",destroyOnClose:!0,footer:null,onCancel:this.onClose,visible:n},F.a.createElement("div",{className:"g-search"},F.a.createElement(P.a,{ref:this.searchFormRef,name:"horizontal_login",layout:"inline",onFinish:function(t){e.onSearch(t)}},F.a.createElement(P.a.Item,{name:"serverType"},F.a.createElement(T.a,{style:{width:150},placeholder:"设备类型",allowClear:!0},Q.a.map(Z.j.se_unittype,(function(e,t){return F.a.createElement(re,{value:parseInt(t),key:t}," ",e," ")})))),F.a.createElement(P.a.Item,{name:"serverIp"},F.a.createElement(y.a,{placeholder:"管理IP",allowClear:!0})),F.a.createElement(P.a.Item,{name:"status"},F.a.createElement(T.a,{style:{width:150},placeholder:"销售状态",allowClear:!0},Q.a.map(Z.j.market,(function(e,t){return F.a.createElement(re,{value:parseInt(t),key:t}," ",e.text," ")})))),F.a.createElement(P.a.Item,{shouldUpdate:!0},F.a.createElement(v.a,{type:"primary",htmlType:"submit"},"搜索")),F.a.createElement(P.a.Item,{shouldUpdate:!0},F.a.createElement(v.a,{type:"primary",htmlType:"reset",onClick:this.onReset},"重置")))),F.a.createElement("div",{className:"c-operate"},F.a.createElement(v.a,{size:"middle",onClick:this.showAddConfirm,className:"actions-btn",style:"see"===l?{display:"none"}:{display:"inline-block"}},"批量关联"),F.a.createElement(v.a,{size:"middle",onClick:"see"===l?function(){return e.onGetMListData()}:function(){return e.onGetMListData({inServer:!0})},className:"actions-btn"},"刷新")),F.a.createElement("div",{className:"g-table"},F.a.createElement(m.a,{columns:this.makeColumns(),rowKey:function(e){return e.id},loading:r,dataSource:a,pagination:u,size:"small",rowSelection:"see"===l?null:{selectedRowKeys:this.state.selectedRowKeys,onChange:function(t,a){e.selectedRow(t,a)}}}))),F.a.createElement("span",{onClick:function(){e.modalShow()}},this.props.children))}}]),n}(F.a.Component),M()(c,"propTypes",{location:K.a.any,history:K.a.any,match:K.a.any,root:K.a.any,cabinetDict:K.a.any,powers:K.a.array,defaultData:K.a.any,onOk:K.a.func,onClose:K.a.func,children:K.a.any,deviceDict:K.a.any,record:K.a.any,serverDict:K.a.any,type:K.a.any}),i=l))||i)||i)||i)||i)||i)||i);function ie(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var ce=T.a.Option;P.a.Item,x.a.confirm,q.a.getPermission();var le=Object(B.b)("root")(te=Object(B.b)("authManage")(te=Object(B.b)("pageUserstore")(te=Object(B.b)("serverPartDict")(te=Object(B.b)("serverDict")(te=Object(B.c)((ne=ae=function(e){E()(n,e);var t,a=(t=n,function(){var e,a=N()(t);if(ie()){var n=N()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return O()(this,e)});function n(e){var t;return k()(this,n),t=a.call(this,e),M()(C()(t),"updateURL",(function(){var e,a,n,r,o=(e={query:t.state.inputValue},a=e.query,n=void 0===a?"":a,(r=new URLSearchParams).set("query",n),r.toString());t.props.history.push("?".concat(o))})),M()(C()(t),"onReset",(function(){t.searchFormRef.current.resetFields()})),t.searchFormRef=F.a.createRef(),t.searchCondition={},t.state={lists:[],loading:!1,pageNum:1,page_size:20,total:0},t}return b()(n,[{key:"componentDidMount",value:function(){this.onGetListData(this.state.pageNum,this.state.page_size)}},{key:"componentWillReceiveProps",value:function(){}},{key:"onGetListData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Q.a.assign({},this.searchCondition,t);this.setState({loading:!0}),V.a.get("".concat(BSS_ADMIN_URL,"/api/old/moban/relation/child/list"),{params:A.a.clearEmpty(a)}).then((function(t){if(t=t.data,A.a.hasStatusOk(t)){var a=t.data.records;e.setState({lists:a,total:t.data.total,pages:t.data.pages,pageNum:t.data.current})}else A.a.dealFail(t);e.setState({loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"makeColumns",value:function(){return[{title:"父模板名称",dataIndex:"parMobanName",key:"parMobanName"},{title:"子模板名称",dataIndex:"mobanName",key:"mobanName"},{title:"设备类型",dataIndex:"deviceType",key:"deviceType",render:function(e,t){return Z.j.se_unittype[e]||"未知类型"}},{title:"服务器网卡数量",dataIndex:"netNum",key:"netNum"},{title:"发布状态",dataIndex:"releaseStatus",key:"releaseStatus",render:function(e,t){return Z.j.releaseStatus[e]||"unknow"}},{title:"显示类型",dataIndex:"showType",key:"showType",render:function(e,t){return Z.j.show_type[e]||"unknow"}},{title:"操作",key:"control",fixed:"right",render:function(e,t){var a=[];return a.push(F.a.createElement(se,{record:t,type:"see"},F.a.createElement(v.a,{key:"0",size:"small",className:"actions-btn",style:{marginRight:"8px"}},"查看服务器"))),a.push(F.a.createElement(se,{record:t,type:"relet"},F.a.createElement(v.a,{key:"1",size:"small",className:"actions-btn"},"关联服务器"))),a}}]}},{key:"onSearch",value:function(e){this.searchCondition=e,this.onGetListData(e)}},{key:"onPageChange",value:function(e,t){this.onGetListData({page:e,pageSize:t})}},{key:"onPageSizeChange",value:function(e,t){this.onGetListData({page:e,pageSize:t})}},{key:"render",value:function(){var e=this,t=(this.props.root.powers,this.state),a=t.loading,n=t.lists,r=t.pageNum,o=t.page_size,s=(t.modalShow,t.total);return F.a.createElement("main",{className:"mian"},F.a.createElement("div",{className:"c-search"},F.a.createElement(P.a,{ref:this.searchFormRef,name:"horizontal_login",layout:"inline",onFinish:function(t){e.onSearch(t)}},F.a.createElement(P.a.Item,{name:"parMobanName"},F.a.createElement(y.a,{placeholder:"请输入父模板名称",allowClear:!0})),F.a.createElement(P.a.Item,{name:"mobanName"},F.a.createElement(y.a,{placeholder:"请输入子模板名称",allowClear:!0})),F.a.createElement(P.a.Item,{name:"deviceType"},F.a.createElement(T.a,{placeholder:"请选择设备类型",allowClear:!0,style:{width:240}},Q.a.map(Z.j.se_unittype,(function(e,t){return F.a.createElement(ce,{key:t,value:parseInt(t)},e)})))),F.a.createElement(P.a.Item,{shouldUpdate:!0},F.a.createElement(v.a,{type:"primary",htmlType:"submit"},"搜索")),F.a.createElement(P.a.Item,{shouldUpdate:!0},F.a.createElement(v.a,{type:"primary",htmlType:"reset",onClick:this.onReset},"重置")))),F.a.createElement("div",{className:"g-table"},F.a.createElement(m.a,{columns:this.makeColumns(),rowKey:function(e){return e.id},loading:a,dataSource:n,pagination:!1,size:"small"})),F.a.createElement("div",{className:"pagination"},F.a.createElement(d.a,{className:"g-pagination",size:"middle",current:r,total:s,showSizeChanger:!0,showQuickJumper:!0,defaultPageSize:o,showTotal:function(e){return"一共".concat(e,"条数据")},onChange:function(t,a){e.onPageChange(t,a)},onShowSizeChange:function(t,a){e.onPageSizeChange(t,a)}})))}}]),n}(F.a.Component),M()(ae,"propTypes",{location:K.a.any,history:K.a.any,userinfo:K.a.any,powers:K.a.array,authManage:K.a.any,match:K.a.any,pageUserstore:K.a.any,root:K.a.any,serverPartDict:K.a.any,serverDict:K.a.any}),te=ne))||te)||te)||te)||te)||te)||te}}]);