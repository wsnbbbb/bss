(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{1574:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return be}));a(172);var n,l,o,r=a(105),i=a.n(r),c=(a(152),a(78)),s=a.n(c),d=(a(47),a(17)),y=a.n(d),u=(a(254),a(116)),m=a.n(u),p=(a(173),a(84)),h=a.n(p),g=a(15),f=a.n(g),C=a(19),b=a.n(C),P=a(6),v=a.n(P),S=a(20),k=a.n(S),E=a(21),w=a.n(E),x=a(13),O=a.n(x),N=a(2),T=a.n(N),D=a(0),I=a.n(D),L=a(1),R=a.n(L),M=a(1592),j=a(23),z=(a(18),a(52)),A=a(9),F=a(28),G=a(134),U=a.n(G),V=(a(174),a(107)),q=a.n(V),J=(a(171),a(89)),K=a.n(J),W=(a(194),a(106)),Q=a.n(W),B=(a(58),a(11)),H=a.n(B),X=(a(98),a(55)),Y=a.n(X),Z=(a(193),a(75)),$=a.n(Z),ee=a(33),te=a.n(ee),ae=(a(154),a(31)),ne=a.n(ae),le=(a(65),a(25)),oe=a.n(le),re=(a(60),a(12)),ie=a.n(re),ce=a(5),se=a.n(ce);function de(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var ye,ue,me,pe=ie.a.Item,he=Object(j.b)("root")(n=Object(j.c)((o=l=function(e){k()(n,e);var t,a=(t=n,function(){var e,a=O()(t);if(de()){var n=O()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return w()(this,e)});function n(e){var t;return f()(this,n),t=a.call(this,e),T()(v()(t),"onFinish",(function(e){console.log(e);var a=t.props,n=a.operateType,l=a.data;if("add"===n)if(1==e.modeType){var o={modeName:e.modeName,modeType:1==e.modeType?"0301":"0302",modeParameter:{orderPayCycle:t.state.orderPayCycle+e.unit1,orderMaxNoPay:t.state.orderMaxNoPay},notifyUrl:e.notifyUrl,product:e.product};console.log(o),t.props.onOk(o)}else{var r={modeName:e.modeName,modeType:1==e.modeType?"0301":"0302",modeParameter:{billingCycle:t.state.billingCycle+e.unit2,billPayCycle:t.state.billPayCycle+e.unit3},notifyUrl:e.notifyUrl,product:e.product};console.log(r),t.props.onOk(r)}else if(1==e.modeType){var i={modeName:e.modeName,id:l.id,modeParameter:{orderPayCycle:t.state.orderPayCycle+e.unit1,orderMaxNoPay:t.state.orderMaxNoPay},notifyUrl:e.notifyUrl};console.log(i),t.props.onOk(i)}else if(2==e.modeType){var c={modeName:e.modeName,id:l.id,modeParameter:{billingCycle:t.state.billingCycle+e.unit2,billPayCycle:t.state.billPayCycle+e.unit3},notifyUrl:e.notifyUrl};console.log(c),t.props.onOk(c)}})),T()(v()(t),"onResetSearch",(function(){t.formRef.current.resetFields()})),T()(v()(t),"onClose",(function(){t.parId=-1,t.props.onClose()})),T()(v()(t),"onSelectRegion",(function(e){t.parId=e})),T()(v()(t),"onChange",(function(e){console.log(e.target.value),1==e.target.value?(t.refs.Prepayment.style.display="block",t.refs.postpaid.style.display="none"):2==e.target.value&&(t.refs.Prepayment.style.display="none",t.refs.postpaid.style.display="block")})),T()(v()(t),"changnum1",(function(e){console.log(e),t.setState({orderPayCycle:e})})),T()(v()(t),"changnum2",(function(e){console.log(e),t.setState({orderMaxNoPay:e})})),T()(v()(t),"changnum3",(function(e){console.log(e),t.setState({billingCycle:e})})),T()(v()(t),"changnum4",(function(e){console.log(e),t.setState({billPayCycle:e})})),console.log(t.props),t.formRef=I.a.createRef(),t.parId=void 0,t.state={modalLoading:!1,modalShowRegion:!1},t}return b()(n,[{key:"componentWillReceiveProps",value:function(e){console.log(e),this.setState({orderPayCycle:e.data.orderPayCycle,orderMaxNoPay:e.data.orderMaxNoPay,billingCycle:e.data.billingCycle,billPayCycle:e.data.billPayCycle})}},{key:"inputnum",value:function(){return!(event.target.value<0||event.target.value>100)||(oe.a.warning({title:"警告",content:"请输入0-100的值",destroyOnClose:!0}),this.formRef.current.setFieldsValue({discount:null,warning:null,audit:null}),!0)}},{key:"render",value:function(){var e=this,t=this.props,a=t.operateType,n=t.data,l=t.modalLoading,o=t.visible,r=t.productList;"0301"==n.modeType?n.modeType=1:n.modeType=2;var i=this.props.data.orderPayCycle,c=this.props.data.orderMaxNoPay,s=this.props.data.billingCycle,d=this.props.data.billPayCycle,u=this.props.data.style_Prepayment,m=this.props.data.style_postpaid;return I.a.createElement("div",null,I.a.createElement(oe.a,{title:{up:"交易模式修改",see:"交易模式查看",add:"自定义交易模式"}[a],maskClosable:!1,width:"50%",destroyOnClose:!0,footer:null,onCancel:this.props.onClose,visible:o},I.a.createElement(q.a,{tip:"Loading...",spinning:l},I.a.createElement(ie.a,{name:"form_in_modal",ref:this.formRef,className:"g-modal-field",onFinish:function(t){e.onFinish(t)},initialValues:n},I.a.createElement(K.a,null,I.a.createElement($.a,{xs:24,sm:24,md:24,lg:24,xl:24},I.a.createElement(pe,te()({name:"modeType",label:"模式类型",rules:[{required:!0,message:"请选择模式类型"}]},F.c),I.a.createElement(ne.a.Group,{onChange:this.onChange,disabled:"up"===a},I.a.createElement(ne.a,{value:1},"预付费模式"),I.a.createElement(ne.a,{value:2},"后付费模式")))),I.a.createElement($.a,{xs:24,sm:24,md:24,lg:24,xl:24},I.a.createElement(pe,te()({name:"id",label:"模式ID",rules:[{required:!0,message:"请输入模式ID"}]},F.c),I.a.createElement(Y.a,{type:"text",disabled:"see"===a}))),I.a.createElement($.a,{xs:24,sm:24,md:24,lg:24,xl:24},I.a.createElement(pe,te()({name:"modeName",label:"模式名",rules:[{required:!0,message:"请输入模式名"}]},F.c),I.a.createElement(Y.a,{type:"text",disabled:"see"===a}))),I.a.createElement($.a,{xs:24,sm:24,md:24,lg:24,xl:24},I.a.createElement(pe,te()({name:"notifyUrl",label:"回调地址",rules:[{required:!0,message:"请输入支付成功后通知业务回调的地址"}]},F.c),I.a.createElement(Y.a,{type:"text",disabled:"see"===a}))),I.a.createElement($.a,{xs:24,sm:24,md:24,lg:24,xl:24},I.a.createElement(pe,te()({name:"product",label:"使用的产品/业务",rules:[{required:!0,message:"请选择使用的产品/业务"}]},F.c),I.a.createElement(H.a,{disabled:"up"===a},se.a.map(r,(function(e,t){return I.a.createElement(Option,{value:e.id,key:t}," ",e.name," ")}))))),I.a.createElement($.a,{xs:24,sm:24,md:24,lg:24,xl:24},I.a.createElement(pe,te()({label:"参数配置"},F.c),I.a.createElement("div",{ref:"Prepayment",style:{display:u}},I.a.createElement(ie.a.Item,{noStyle:!0,name:"orderPayCycle"},"订单支付周期：",I.a.createElement(Q.a,{min:1,defaultValue:i,style:{width:120},onChange:this.changnum1})),I.a.createElement(ie.a.Item,{name:"unit1",noStyle:!0},I.a.createElement(H.a,{allowClear:!0,style:{width:80}},se.a.map(F.j,(function(e,t){return I.a.createElement(Option,{value:t,key:t},e)})))),I.a.createElement("br",null),I.a.createElement("br",null),I.a.createElement(ie.a.Item,{noStyle:!0,name:"orderMaxNoPay"},"未支付订单数量：",I.a.createElement(Q.a,{min:1,defaultValue:c,onChange:this.changnum2,style:{width:180}}))),I.a.createElement("div",{ref:"postpaid",style:{display:m}},I.a.createElement(ie.a.Item,{noStyle:!0,name:"billingCycle"},"计费周期：",I.a.createElement(Q.a,{min:1,defaultValue:s,onChange:this.changnum3,style:{width:120}})),I.a.createElement(ie.a.Item,{name:"unit2",noStyle:!0},I.a.createElement(H.a,{allowClear:!0,style:{width:80}},se.a.map(F.j,(function(e,t){return I.a.createElement(Option,{value:t,key:t},e)})))),I.a.createElement("br",null),I.a.createElement("br",null),I.a.createElement(ie.a.Item,{noStyle:!0,name:"billPayCycle"},"账单支付周期：",I.a.createElement(Q.a,{min:1,defaultValue:d,onChange:this.changnum4,style:{width:120}})),I.a.createElement(ie.a.Item,{name:"unit3",noStyle:!0},I.a.createElement(H.a,{allowClear:!0,style:{width:80}},se.a.map(F.j,(function(e,t){return I.a.createElement(Option,{value:t,key:t},e)})))))))),I.a.createElement("div",{className:"actions-btn"},I.a.createElement(y.a,{htmlType:"submit",className:"action-btn ok"},"确认"),I.a.createElement(y.a,{onClick:this.onClose,className:"action-btn ok"},"取消"))))))}}]),n}(I.a.Component),T()(l,"propTypes",{root:R.a.any,operateType:R.a.string,powers:R.a.array,data:R.a.any,visible:R.a.bool,modalLoading:R.a.bool,onClose:R.a.func}),n=o))||n)||n;function ge(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function fe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(a),!0).forEach((function(t){T()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ge(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ce(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var be=Object(j.b)("root")(ye=Object(j.c)((me=ue=function(e){k()(n,e);var t,a=(t=n,function(){var e,a=O()(t);if(Ce()){var n=O()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return w()(this,e)});function n(e){var t;return f()(this,n),t=a.call(this,e),T()(v()(t),"searchFormRef",I.a.createRef()),T()(v()(t),"onResetSearch",(function(){t.searchFormRef.current.resetFields()})),T()(v()(t),"onModalClose",(function(){t.setState({modalShow:!1,changemodalShow:!1})})),console.log(t.props),t.selectedRow={length:0,keys:[],rows:[]},t.searchParam={},t.state={searchParam:{},lists:[],loading:!1,page:1,pageSize:20,total:0,modalLoading:!1,nowData:{},modalShow:!1,selectedRowKeys:[],regionInfo:{},productList:[]},t}return b()(n,[{key:"componentDidMount",value:function(){this.onGetListData(),this.getProductList()}},{key:"getProductList",value:function(){var e=this;U()({method:"get",url:"".concat(TRADING_API,"/admin/mode/products"),headers:{Authorization:"token "+z.a.getToken()}}).then((function(t){t=t.data,console.log(t),A.a.hasStatusOk(t)?e.setState({productList:t.data}):A.a.dealFail(t),e.setState({loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"onGetListData",value:function(e){var t=this;e=e||this.state.regionInfo;var a=_.assign({},{page:1},this.searchParam,fe({},e));this.setState({loading:!0}),U()({method:"get",url:"".concat(TRADING_API,"/admin/mode/page"),headers:{Authorization:"token "+z.a.getToken()},params:a}).then((function(e){e=e.data,console.log(e),A.a.hasStatusOk(e)?t.setState({lists:e.data.records,total:e.data.total}):A.a.dealFail(e),t.setState({loading:!1})})).catch((function(){t.setState({loading:!1})}))}},{key:"onPageChange",value:function(e,t){this.setState({page:e}),this.onGetListData({page:e,size:t})}},{key:"onPageSizeChange",value:function(e,t){this.setState({page:e,pageSize:t}),this.onGetListData({page:e,size:t})}},{key:"onSearchfrom",value:function(e){this.searchParam=e,this.setState({searchValue:e}),this.onGetListData(e)}},{key:"onModalShow",value:function(e,t){if("up"==e){if("0301"==t.modeType){var a=fe({},t,{style_Prepayment:"block",style_postpaid:"none",orderPayCycle:t.parameter.orderPayCycle,orderMaxNoPay:t.parameter.orderMaxNoPay,billingCycle:t.parameter.billingCycle,billPayCycle:t.parameter.billPayCycle});null!==a.orderPayCycle&&(-1!==a.orderPayCycle.indexOf("d")?(a.unit1="d",a.orderPayCycle=a.orderPayCycle.split("d")[0]):(a.unit1="h",a.orderPayCycle=a.orderPayCycle.split("h")[0])),null!==a.billingCycle&&(-1!==a.billingCycle.indexOf("d")?(a.unit2="d",a.billingCycle=a.billingCycle.split("d")[0]):(a.unit2="h",a.billingCycle=a.billingCycle.split("h")[0])),null!==a.billPayCycle&&(-1!==a.billPayCycle.indexOf("d")?(a.unit3="d",a.billPayCycle=a.billPayCycle.split("d")[0]):(a.unit3="h",a.billPayCycle=a.billPayCycle.split("h")[0])),console.log(a),this.setState({modalShow:!0,nowData:a,operateType:e})}else if("0302"==t.modeType){var n=fe({},t,{style_Prepayment:"none",style_postpaid:"block",orderPayCycle:t.parameter.orderPayCycle,orderMaxNoPay:t.parameter.orderMaxNoPay,billingCycle:t.parameter.billingCycle,billPayCycle:t.parameter.billPayCycle});null!==n.orderPayCycle&&(-1!==n.orderPayCycle.indexOf("d")?(n.unit1="d",n.orderPayCycle=n.orderPayCycle.split("d")[0]):(n.unit1="h",n.orderPayCycle=n.orderPayCycle.split("h")[0])),null!==n.billingCycle&&(-1!==n.billingCycle.indexOf("d")?(n.unit2="d",n.billingCycle=n.billingCycle.split("d")[0]):(n.unit2="h",n.billingCycle=n.billingCycle.split("h")[0])),null!==n.billPayCycle&&(-1!==n.billPayCycle.indexOf("d")?(n.unit3="d",n.billPayCycle=n.billPayCycle.split("d")[0]):(n.unit3="h",n.billPayCycle=n.billPayCycle.split("h")[0])),console.log(n),this.setState({modalShow:!0,nowData:n,operateType:e})}}else if("0301"==t.modeType){var l=fe({},t,{style_Prepayment:"block",style_postpaid:"none",unit1:"d",unit2:"d",unit3:"d"});this.setState({modalShow:!0,nowData:l,operateType:e})}else{var o=fe({},t,{style_Prepayment:"none",style_postpaid:"block",unit1:"d",unit2:"d",unit3:"d"});console.log(o),this.setState({modalShow:!0,nowData:o,operateType:e})}}},{key:"changePassword",value:function(e){this.setState({changemodalShow:!0,nowData:e})}},{key:"onModalOk",value:function(e){var t=this;if("add"==this.state.operateType){console.log(e);var a=A.a.clearNull(e);U()({method:"post",url:"".concat(TRADING_API,"/admin/mode/add"),headers:{Authorization:"token "+z.a.getToken()},data:a}).then((function(e){e=e.data,console.log(e),A.a.hasStatusOk(e)?(t.setState({modalLoading:!1,modalShow:!1}),t.onGetListData(),A.a.auto_close_result("ok","操作成功")):A.a.dealFail(e),t.setState({modalLoading:!1})})).catch((function(){t.setState({modalLoading:!1})}))}else console.log(e),this.setState({loading:!0,modalLoading:!0}),U()({method:"put",url:"".concat(TRADING_API,"/admin/mode/edit"),headers:{Authorization:"token "+z.a.getToken()},data:e}).then((function(e){console.log(e),e=e.data,A.a.hasStatusOk(e)?(A.a.auto_close_result("ok","操作成功"),t.setState({page:1,modalLoading:!1,modalShow:!1}),t.onGetListData({page:1})):A.a.dealFail(e),t.setState({modalLoading:!1,loading:!1})})).catch((function(){t.setState({modalLoading:!1,loading:!1})}))}},{key:"onChangepassWord",value:function(e){console.log(e)}},{key:"makeColumns",value:function(){var e=this,t=this.state.productList;return[{title:"模式ID",dataIndex:"id",key:"id"},{title:"模式名",dataIndex:"modeName",key:"modeName"},{title:"模式类型",dataIndex:"modeType",key:"modeType",render:function(e,t){return F.e[e]}},{title:"使用的产品/业务",dataIndex:"product",key:"product",render:function(e,a){return t.map((function(t){if(t.id==e)return console.log(t.name),t.name}))}},{title:"回调地址",dataIndex:"notifyUrl",key:"notifyUrl"},{title:"参数配置",dataIndex:"parameter",key:"parameter",width:400,render:function(e,t){return"0301"==t.modeType?"订单付款周期:"+e.orderPayCycle+", 未支付订单数量:"+e.orderMaxNoPay:" 计费周期:"+e.billingCycle+", 账单支付周期:"+e.billPayCycle}},{title:"操作",key:"control",fixed:"right",width:240,render:function(t,a){var n=[];n.push(I.a.createElement("span",{key:"1",className:"control-btn blue",onClick:function(){return e.onModalShow("up",a)}},I.a.createElement(h.a,{placement:"top",title:"编辑"},I.a.createElement(M.a,null))));var l=[];return n.forEach((function(e,t){t&&l.push(I.a.createElement(m.a,{key:"line".concat(t),type:"vertical"})),l.push(e)})),l}}]}},{key:"render",value:function(){var e=this,t=this.state,a=t.lists,n=t.loading,l=t.page,o=t.pageSize,r=t.total;return I.a.createElement("main",{className:"mian"},I.a.createElement("div",{className:"g-operate"},I.a.createElement(y.a,{size:"middle",className:"actions-btn",onClick:function(){return e.onModalShow("add",{modeType:"0301"})}},"自定义交易模式")),I.a.createElement("div",{className:"g-table"},I.a.createElement(s.a,{scroll:{x:1600},columns:this.makeColumns(),rowKey:function(e){return e.id},loading:n,dataSource:a,pagination:!1}),I.a.createElement("div",{className:"g-pagination"},I.a.createElement(i.a,{current:l,total:r,pageSize:o,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e){return"共 ".concat(e," 条")},onChange:function(t,a){e.onPageChange(t,a)},onShowSizeChange:function(t,a){e.onPageSizeChange(t,a)}}))),I.a.createElement(he,{visible:this.state.modalShow,modalLoading:this.state.modalLoading,data:this.state.nowData,operateType:this.state.operateType,onOk:function(t){return e.onModalOk(t)},onClose:function(){return e.onModalClose()},num:this.state.num,productList:this.state.productList}))}}]),n}(I.a.Component),T()(ue,"propTypes",{location:R.a.any,history:R.a.any,root:R.a.any,match:R.a.any}),ye=me))||ye)||ye}}]);