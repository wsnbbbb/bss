(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1556:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return _e}));a(65);var n,o,r,s=a(25),i=a.n(s),l=(a(175),a(66)),c=a.n(l),d=(a(172),a(105)),u=a.n(d),p=(a(152),a(78)),h=a.n(p),m=(a(47),a(17)),f=a.n(m),g=(a(98),a(55)),y=a.n(g),S=(a(254),a(116)),v=a.n(S),w=(a(255),a(133)),k=a.n(w),E=(a(173),a(84)),D=a.n(E),b=(a(132),a(35)),C=a.n(b),T=a(15),O=a.n(T),N=a(19),R=a.n(N),x=a(6),I=a.n(x),M=a(20),L=a.n(M),K=a(21),P=a.n(K),U=a(13),_=a.n(U),j=a(2),z=a.n(j),G=(a(60),a(12)),F=a.n(G),V=(a(58),a(11)),A=a.n(V),q=a(0),B=a.n(q),H=a(1),Q=a.n(H),J=a(1596),W=a(1592),X=a(1920),Y=a(1926),Z=a(1589),$=a(1587),ee=a(23),te=a(9),ae=a(52),ne=(a(71),a(5)),oe=a.n(ne),re=a(18),se=a(33),ie=a.n(se),le=(a(416),a(192)),ce=a.n(le);function de(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var ue,pe,he,me=F.a.Item,fe=ce.a.TreeNode,ge=(ce.a.SHOW_PARENT,Object(ee.b)("root")(n=Object(ee.b)("authManage")(n=Object(ee.b)("pageUserstore")(n=Object(ee.c)((r=o=function(e){L()(n,e);var t,a=(t=n,function(){var e,a=_()(t);if(de()){var n=_()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return P()(this,e)});function n(e){var t;return O()(this,n),t=a.call(this,e),z()(I()(t),"onClose",(function(){t.props.onClose()})),z()(I()(t),"onFinish",(function(e){if("add"===t.props.operateType&&t.props.onOk(e),"up"===t.props.operateType){var a=t.props.nowData.id;e.version=t.props.nowData.version,t.props.edit(a,e)}})),z()(I()(t),"reset",(function(){t.formRef.current.resetFields()})),z()(I()(t),"onChange",(function(e){t.setState({value:e})})),z()(I()(t),"getNodes",(function(e){return e.reduce((function(e,a){return e.push(B.a.createElement(fe,{value:a.id,title:a.name,key:a.id},a.children?t.getNodes(a.children):null)),e}),[])})),t.formRef=B.a.createRef(),t.state={modalLoading:!1,nowData:null,fetching:!0,loading:!1,treenode:[]},t}return R()(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillReceiveProps",value:function(e){}},{key:"render",value:function(){var e=this,t=this.props,a=t.operateType,n=t.nowData,o=t.treenode,r={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}};return B.a.createElement("div",null,B.a.createElement(i.a,{title:{add:"新增",up:"修改",see:"查看"}[a],maskClosable:!1,width:"60%",destroyOnClose:!0,visible:this.props.visible,onCancel:this.onClose,confirmLoading:this.state.modalLoading,footer:null},B.a.createElement(F.a,{name:"form_in_modal",ref:this.formRef,initialValues:n,onFinish:function(t){e.onFinish(t)},className:"g-modal-field"},B.a.createElement(me,ie()({label:"角色名称",name:"rolename",rules:[{required:!0,whitespace:!0,message:"必填"},{max:12,message:"最多输入12位字符"}]},r),B.a.createElement(y.a,{placeholder:"请输入角色名",disabled:"see"===a})),B.a.createElement(me,ie()({label:"部门",name:"deptId",rules:[{required:!0,message:"必填"}]},r),B.a.createElement(ce.a,{showSearch:!0,style:{width:"100%"},placeholder:"请选择部门",allowClear:!0,treeDefaultExpandedKeys:["1"]},this.getNodes(o))),B.a.createElement("div",{className:"actions-btn"},B.a.createElement(f.a,{htmlType:"submit",className:"action-btn ok",style:"see"===a?{display:"none"}:{display:"inline-block"}},"提交"),B.a.createElement(f.a,{htmlType:"reset",className:"action-btn ok",onClick:this.reset,style:"see"===a?{display:"none"}:{display:"inline-block"}},"重置"),B.a.createElement(f.a,{onClick:this.onClose,className:"action-btn ok",style:{margin:"0 auto"}},"取消")))))}}]),n}(B.a.Component),z()(o,"propTypes",{location:Q.a.any,history:Q.a.any,userinfo:Q.a.any,powers:Q.a.array,updateLists:Q.a.func}),n=r))||n)||n)||n)||n),ye=a(1636),Se=(a(171),a(89)),ve=a.n(Se),we=(a(193),a(75)),ke=a.n(we),Ee=(a(1666),a(1667)),De=a.n(Ee);a(1615);function be(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Ce,Te,Oe,Ne=Object(ee.b)("authManage")(ue=Object(ee.c)((he=pe=function(e){L()(n,e);var t,a=(t=n,function(){var e,a=_()(t);if(be()){var n=_()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return P()(this,e)});function n(e){var t;return O()(this,n),t=a.call(this,e),z()(I()(t),"onOk",(function(){t.handleOk(t.state.targetKeys)})),z()(I()(t),"handleOk",(function(e){t.setState({loading:!0});var a=t.props.record,n=a.id,o=a.rolename,r=a.deptId;null!==e&&t.props.authManage.upRole(n,{rolename:o,deptId:r,userIds:e,version:t.state.userVersion}).then((function(e){t.setState({loading:!1}),2e4===e.code?(t.setState({showModal:!1}),C.a.success("分配角色成功")):(t.setState({showModal:!1}),C.a.error(e.data))})).catch((function(){t.setState({showModal:!1})}))})),z()(I()(t),"onClose",(function(){t.setState({targetKeys:[],mockData:[]}),t.setState({showModal:!1})})),z()(I()(t),"filterOption",(function(e,t){return t.name.indexOf(e)>-1})),z()(I()(t),"handleChange2",(function(e,a,n){t.setState({targetKeys:e})})),z()(I()(t),"handleSearch",(function(e,t){})),t.selectedKeys=[],t.state={nowKeys:[],loading:!1,mockData:[],targetKeys:[],userVersion:0},t}return R()(n,[{key:"componentDidMount",value:function(){}},{key:"onGetUerLists",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=oe.a.assign({},t);this.props.authManage.getUserList(te.a.clearNull(a)).then((function(t){2e4===t.code?e.setState({mockData:t.data.records}):C.a.error(t.message),e.setState({loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"modalShow",value:function(){var e=this;this.onGetUerLists({page:1,deptId:1,pageSize:400}),this.props.authManage.getRoles2(this.props.record.id).then((function(t){if(2e4===t.code){var a=[];t.data.users.forEach((function(e){a.push(e.id)})),e.setState({targetKeys:a,userVersion:t.data.version})}else C.a.error(t.data)})).catch((function(){})),this.setState({showModal:!0})}},{key:"render",value:function(){var e=this,t=this.props.record;return B.a.createElement("main",{style:{display:"inline-block"}},B.a.createElement(i.a,{title:"关联员工",visible:this.state.showModal,destroyOnClose:!0,width:"60%",onOk:this.onOk,onCancel:this.onClose,okText:"确认",cancelText:"取消"},B.a.createElement(D.a,{title:"角色名称"},B.a.createElement("span",{style:{marginLeft:"100px",fontSize:"20px"}},t&&t.rolename||"")),B.a.createElement("br",null),B.a.createElement("br",null),B.a.createElement(ve.a,null,B.a.createElement(ke.a,{xs:24,sm:24,md:24,lg:24,xl:24},B.a.createElement(De.a,{dataSource:this.state.mockData,showSearch:!0,listStyle:{width:280,height:360},locale:{itemUnit:"项",itemsUnit:"项",searchPlaceholder:"请输入搜索内容"},rowKey:function(e){return e.id},filterOption:this.filterOption,targetKeys:this.state.targetKeys,onChange:this.handleChange2,onSearch:this.handleSearch,render:function(e){return e.name},titles:["请选择用户","拥有此角色的用户"],pagination:!0})))),B.a.createElement("span",{onClick:function(){e.modalShow()}},this.props.children))}}]),n}(B.a.PureComponent),z()(pe,"propTypes",{data:Q.a.array,title:Q.a.string,visible:Q.a.bool,defaultKeys:Q.a.array,loading:Q.a.bool,onOk:Q.a.func,onClose:Q.a.func,record:Q.a.object}),ue=he))||ue)||ue;function Re(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var xe,Ie,Me,Le=Object(ee.b)("authManage")(Ce=Object(ee.c)((Oe=Te=function(e){L()(n,e);var t,a=(t=n,function(){var e,a=_()(t);if(Re()){var n=_()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return P()(this,e)});function n(e){var t;return O()(this,n),t=a.call(this,e),z()(I()(t),"onOk",(function(){t.handleOk(t.state.targetKeys)})),z()(I()(t),"handleOk",(function(e){t.setState({loading:!0});var a=t.props.record,n=a.id,o=a.rolename,r=a.deptId;t.props.authManage.upRole(n,{rolename:o,deptId:r,permissionIds:e,version:t.state.powerVersion}).then((function(e){t.setState({loading:!0}),2e4===e.code?(t.setState({showModal:!1}),C.a.success("分配权限成功")):(C.a.error(e.data),t.setState({showModal:!1}))})).catch((function(){t.setState({showModal:!1})}))})),z()(I()(t),"onClose",(function(){t.setState({targetKeys:[],mockData:[]}),t.setState({showModal:!1})})),z()(I()(t),"filterOption",(function(e,t){return t.permissionsName.indexOf(e)>-1})),z()(I()(t),"handleChange2",(function(e){t.setState({targetKeys:e})})),z()(I()(t),"handleSearch",(function(e,t){})),t.selectedKeys=[],t.state={nowKeys:[],loading:!1,mockData:[],targetKeys:[],powerVersion:0},t}return R()(n,[{key:"componentDidMount",value:function(){}},{key:"onGetPowerTreeData",value:function(){var e=this;this.props.authManage.getAllPower().then((function(t){2e4===t.code?e.setState({mockData:t.data,loading:!1}):C.a.error(t.message)})).catch((function(t){e.setState({loading:!1})}))}},{key:"modalShow",value:function(){var e=this;this.onGetPowerTreeData(),this.props.authManage.getRoles2(this.props.record.id).then((function(t){if(2e4===t.code){var a=[];t.data.permissions.forEach((function(e){a.push(e.id)})),e.setState({targetKeys:a,powerVersion:t.data.version})}else C.a.error(t.data)})).catch((function(){})),this.setState({showModal:!0})}},{key:"render",value:function(){var e=this,t=this.props.record,a=this.state,n=a.mockData,o=a.targetKeys;return B.a.createElement("main",{style:{display:"inline-block"}},B.a.createElement(i.a,{title:"分配权限",visible:this.state.showModal,destroyOnClose:!0,onOk:this.onOk,onCancel:this.onClose,okText:"确认",cancelText:"取消",width:"60%"},B.a.createElement(D.a,{title:"角色名称"},B.a.createElement("span",{style:{marginLeft:"100px",fontSize:"20px"}},t&&t.rolename||"")),B.a.createElement("br",null),B.a.createElement("br",null),B.a.createElement(ve.a,null,B.a.createElement(ke.a,{xs:24,sm:24,md:24,lg:24,xl:24},B.a.createElement(De.a,{dataSource:n,showSearch:!0,listStyle:{width:300,height:360},locale:{itemUnit:"项",itemsUnit:"项",searchPlaceholder:"请输入搜索内容"},rowKey:function(e){return e.id},filterOption:this.filterOption,targetKeys:o,onChange:this.handleChange2,onSearch:this.handleSearch,render:function(e){return e.permissionsName},titles:["请选择权限","拥有的权限"],pagination:!0})))),B.a.createElement("span",{onClick:function(){e.modalShow()}},this.props.children))}}]),n}(B.a.PureComponent),z()(Te,"propTypes",{data:Q.a.array,title:Q.a.string,visible:Q.a.bool,defaultKeys:Q.a.array,loading:Q.a.bool,onOk:Q.a.func,onClose:Q.a.func,record:Q.a.object}),Ce=Oe))||Ce)||Ce,Ke=a(28),Pe=(a(1727),a(153));function Ue(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}A.a.Option,F.a.Item;var _e=Object(ee.b)("root")(xe=Object(ee.b)("authManage")(xe=Object(ee.b)("pageUserstore")(xe=Object(ee.c)((Me=Ie=function(e){L()(n,e);var t,a=(t=n,function(){var e,a=_()(t);if(Ue()){var n=_()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return P()(this,e)});function n(e){var t;return O()(this,n),t=a.call(this,e),z()(I()(t),"updateURL",(function(){var e,a,n,o,r=(e={query:t.state.inputValue},a=e.query,n=void 0===a?"":a,(o=new URLSearchParams).set("query",n),o.toString());t.props.history.push("?".concat(r))})),z()(I()(t),"onReset",(function(){t.searchFormRef.current.resetFields(),t.searchCondition={}})),z()(I()(t),"handleOk2",(function(e){t.setState({loading:!0});var a=t.records,n=a.id,o=a.rolename,r=a.deptId;t.props.authManage.upRole(n,{rolename:o,deptId:r,permissionIds:e,version:t.state.powerVersion}).then((function(e){t.setState({loading:!0}),2e4===e.code?(t.onGetListData({deptId:t.state.orgTreeDefault,page:1}),t.handleCancel2(),C.a.success("分配权限成功")):(C.a.error(e.data),t.setState({defPowerTreeShow:!1,loading:!1}))})).catch((function(){t.setState({defPowerTreeShow:!1,loading:!1})}))})),z()(I()(t),"handleCancel2",(function(){t.setState({defPowerTreeShow:!1,powerTreeDefault:[]})})),z()(I()(t),"onModalOk",(function(e){t.setState({loading:!0}),re.a.post("".concat(BSS_ADMIN_URL,"/api/user/role/add"),e).then((function(e){t.setState({loading:!1}),2e4===(e=e.data).code?(t.onClose(),t.onGetListData({deptId:t.state.orgTreeDefault,page:1}),C.a.success("添加成功")):C.a.error(e.data)})).catch((function(){t.setState({modalLoading:!1})}))})),z()(I()(t),"edit",(function(e,a){t.setState({loading:!0}),t.props.authManage.upRole(e,a).then((function(e){t.setState({loading:!1}),2e4===e.code?(t.onClose(),t.onGetListData({deptId:t.state.orgTreeDefault,page:1}),C.a.success("修改成功")):C.a.error(e.data)})).catch((function(){t.setState({modalLoading:!1})}))})),z()(I()(t),"onClose",(function(){t.setState({modalShow:!1})})),z()(I()(t),"onModalClose",(function(){t.setState({modalShow:!1})})),z()(I()(t),"onDetailShow",(function(e){t.setState({detailShow:!0});var a=[],n=[];t.props.authManage.getRoles2(e.id).then((function(o){2e4===o.code?(o.data.permissions.forEach((function(e){a.push(e.permissionsName)})),o.data.users.forEach((function(e){n.push(e.name)})),t.setState({permissionsName:a,userIds:n,rolename:e&&e.rolename,depts:o.data.dept.name})):C.a.error(o.data)})).catch((function(){t.setState({detailShow:!1}),C.a.error(res.data)}))})),z()(I()(t),"detailHandleOk",(function(){t.setState({detailShow:!1})})),z()(I()(t),"detailHandleCancel",(function(){t.setState({detailShow:!1})})),t.searchFormRef=B.a.createRef(),t.searchCondition={},t.state={lists:[],roleData:[],operateType:"add",loading:!1,modalShow:!1,modalLoading:!1,nowData:{},selectedOrgId:null,powerTreeDefault:[],orgTreeDefault:Ke.h.key,roleTreeShow:!1,roleTreeDefault:[],pageNum:1,pageSize:20,total:0,treeLoading:!1,treeOnOkLoading:!1,powerList:[],userLists:[],treenode:[],defPowerTreeShow:!1,type2:"role",userListsDefault:[],users:[],permissionsName:[],userIds:[],detailShow:!1,rolename:"",powerVersion:0,userVersion:0,depts:""},t}return R()(n,[{key:"componentDidMount",value:function(){this.onGetListData(this.state.pageNum,this.state.pageSize),this.getOrgData()}},{key:"getOrgData",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],oe.a.assign({},{otherDept:0}));this.props.authManage.getDeptLists(t).then((function(t){2e4==t.code&&e.setState({treenode:te.a.formatTree(t.data)}),e.setState({loading:!1})})).catch((function(t){e.setState({loading:!1})}))}},{key:"getRolebyOrg",value:function(e){this.key=e,this.setState({orgTreeDefault:e,page:1,searchParam:{}}),this.onGetListData({page:1,deptId:e})}},{key:"onGetListData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=oe.a.assign({},this.searchCondition,t);this.setState({loading:!0}),this.props.authManage.getRoles(te.a.clearEmpty(a)).then((function(t){2e4===t.code?e.setState({lists:t.data.records,total:t.data.total,pageNum:t.data.current}):C.a.error(t.message),e.setState({loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"onGetUerLists",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=oe.a.assign({},t);this.props.authManage.getUserList(te.a.clearNull(a)).then((function(t){2e4===t.code?e.setState({userLists:t.data.records}):C.a.error(t.message),e.setState({loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"makeColumns",value:function(){var e=this;return[{title:"序号",dataIndex:"id",key:"id",render:function(e,t,a){return a+1}},{title:"角色名称",dataIndex:"rolename",key:"rolename"},{title:"操作",key:"control",fixed:"right",width:240,render:function(t,a){var n=[],o=ae.a.getPermission()||[];o.includes("role-view")&&n.push(B.a.createElement("span",{key:"0",className:"control-btn green",onClick:function(){return e.onDetailShow(a)}},B.a.createElement(D.a,{placement:"top",title:"查看"},B.a.createElement(J.a,{style:{color:"#1890ff"}})))),o.includes("role-edit")&&n.push(B.a.createElement("span",{key:"1",className:"control-btn blue",onClick:function(){return e.onModalShow("up",a)}},B.a.createElement(D.a,{placement:"top",title:"修改"},B.a.createElement(W.a,null)))),o.includes("role-edit")&&n.push(B.a.createElement(Le,{record:a},B.a.createElement("span",{key:"2",className:"control-btn blue"},B.a.createElement(D.a,{placement:"top",title:"分配权限"},B.a.createElement(X.a,null))))),o.includes("role-edit")&&n.push(B.a.createElement(Ne,{record:a},B.a.createElement("span",{key:"3",className:"control-btn blue"},B.a.createElement(D.a,{placement:"top",title:"关联员工"},B.a.createElement(Y.a,null))))),o.includes("role-delete")&&n.push(B.a.createElement(k.a,{key:"4",title:"确定删除吗?",onConfirm:function(){return e.onDel(a.id)},okText:"确定",cancelText:"取消"},B.a.createElement("span",{className:"control-btn red"},B.a.createElement(D.a,{placement:"top",title:"删除"},B.a.createElement(Z.a,null)))));var r=[];return n.forEach((function(e,t){t&&r.push(B.a.createElement(v.a,{key:"line".concat(t),type:"vertical"})),r.push(e)})),r}}]}},{key:"onSearch",value:function(e){this.searchCondition=e,this.onGetListData(e)}},{key:"onPageChange",value:function(e,t){this.onGetListData({deptId:this.state.orgTreeDefault,page:e,pageSize:t})}},{key:"onPageSizeChange",value:function(e,t){this.onGetListData({deptId:this.state.orgTreeDefault,page:e,pageSize:t})}},{key:"onModalShow",value:function(e,t){var a=this;if("add"===e)return this.getOrgData(),void this.setState({operateType:e,nowData:{deptId:void 0===this.key?"1":this.key},modalShow:!0});this.props.authManage.getRoles2(t.id).then((function(t){if(2e4===t.code){[].push(t.data.deptId),a.setState({nowData:{id:t.data.id,rolename:t.data.rolename,deptId:t.data.dept.id,version:t.data.version},modalShow:!0,operateType:e})}else C.a.error(t.data)})).catch((function(){C.a.error(res.data)}))}},{key:"onDel",value:function(e){var t=this;this.setState({loading:!0}),this.props.authManage.delRole(e).then((function(e){2e4===e.code?(t.onGetListData({deptId:t.state.orgTreeDefault,page:1}),C.a.success("删除成功"),t.setState({loading:!1})):(C.a.error(e.data),t.setState({loading:!1}))})).catch((function(){t.setState({loading:!1})}))}},{key:"onTreeShowClick2",value:function(e){var t=this;this.records=e,this.props.authManage.getRoles2(e.id).then((function(e){if(2e4===e.code){var a=[];e.data.permissions.forEach((function(e){a.push(e.id)})),t.setState({powerTreeDefault:a,powerVersion:e.data.version,defPowerTreeShow:!0})}else C.a.error(e.data)})).catch((function(){}))}},{key:"onRoleClose",value:function(){this.setState({roleTreeShow:!1})}},{key:"render",value:function(){var e=this,t=(this.props.root.powers,this.state),a=t.loading,n=t.operateType,o=t.lists,r=t.pageNum,s=(t.pageSize,t.modalShow),l=t.nowData,d=t.selectedOrgId,p=(t.roleData,t.roleTreeShow,t.roleTreeDefault,t.roleTreeLoading,t.powerTreeShow,t.powerData,t.powerTreeDefault,t.treeLoading,t.powerList,t.userLists,t.total),m=t.treenode,g=(t.defPowerTreeShow,t.users,t.permissionsName),S=t.userIds,v=t.rolename,w=(t.powerVersion,t.depts);this.records;return B.a.createElement("main",{className:"mian"},B.a.createElement("div",{className:"left-contain"},B.a.createElement(ye.a,{nowDataKey:d,type2:this.state.type2,onQuery:function(t,a){e.getRolebyOrg(t,a)}})),B.a.createElement("div",{className:"right-contain"},B.a.createElement("div",{className:"clearfix"},B.a.createElement("div",{className:"c-search",style:{float:"left"}},B.a.createElement(F.a,{ref:this.searchFormRef,name:"horizontal_login",layout:"inline",onFinish:function(t){e.onSearch(t)}},B.a.createElement(F.a.Item,{name:"roleName",rules:[{whiteSpace:!0,message:"不能输入空格"},{pattern:Pe.a.isNormalEncode,message:"不能输入特殊字符"}]},B.a.createElement(y.a,{placeholder:"角色名称",allowClear:!0})),B.a.createElement(F.a.Item,{shouldUpdate:!0},B.a.createElement(f.a,{type:"primary",htmlType:"submit"},"搜索")),B.a.createElement(F.a.Item,{shouldUpdate:!0},B.a.createElement(f.a,{type:"primary",htmlType:"reset",onClick:this.onReset},"重置")))),B.a.createElement("div",{className:"c-operate",style:{float:"right"}},ae.a.hasPermission("role-add")&&B.a.createElement(f.a,{size:"middle",onClick:function(){e.onModalShow("add",{})},style:{color:"#1890ff",borderColor:"#1890ff"},icon:B.a.createElement($.a,null)},"增加角色"))),B.a.createElement("div",{className:"g-table"},B.a.createElement(h.a,{columns:this.makeColumns(),rowKey:function(e){return e.id},loading:a,dataSource:o,pagination:!1,scroll:{y:800}}),B.a.createElement("div",{className:"pagination"},B.a.createElement(u.a,{className:"g-pagination",current:r,showSizeChanger:!0,showQuickJumper:!0,total:p,defaultPageSize:this.state.pageSize,onChange:function(t,a){e.onPageChange(t,a)},onShowSizeChange:function(t,a){e.onPageSizeChange(t,a)},showTotal:function(e){return"一共".concat(e,"条数据")}}))),B.a.createElement(ge,{operateType:n,nowData:l,visible:s,updateLists:this.onGetListData,onOk:this.onModalOk,edit:this.edit,onClose:this.onModalClose,treenode:m,total:p}),B.a.createElement(i.a,{title:"角色信息",visible:this.state.detailShow,onCancel:this.detailHandleCancel,width:"60%",destroyOnClose:!0,footer:null},B.a.createElement("p",{className:"p"},B.a.createElement("strong",null,"角色名称:"),B.a.createElement(c.a,{color:"#f50"},v)),B.a.createElement("p",{className:"p"},B.a.createElement("strong",null,"所属机构:"),B.a.createElement(c.a,{color:"#2db7f5"},w)),B.a.createElement("p",{className:"p"},B.a.createElement("strong",null,"角色权限:"),g&&g.map((function(e){return B.a.createElement(c.a,{color:"#87d068",key:e},e)}))),B.a.createElement("p",{className:"p"},B.a.createElement("strong",null,"关联员工:"),S&&S.map((function(e){return B.a.createElement(c.a,{color:"#108ee9",key:e},e)}))))))}}]),n}(B.a.Component),z()(Ie,"propTypes",{location:Q.a.any,history:Q.a.any,userinfo:Q.a.any,powers:Q.a.array}),xe=Me))||xe)||xe)||xe)||xe},1615:function(e,t,a){},1636:function(e,t,a){"use strict";a(47);var n,o,r,s=a(17),i=a.n(s),l=a(33),c=a.n(l),d=(a(98),a(55)),u=a.n(d),p=(a(174),a(107)),h=a.n(p),m=(a(419),a(421)),f=a.n(m),g=(a(420),a(188)),y=a.n(g),S=(a(132),a(35)),v=a.n(S),w=a(15),k=a.n(w),E=a(19),D=a.n(E),b=a(6),C=a.n(b),T=a(20),O=a.n(T),N=a(21),R=a.n(N),x=a(13),I=a.n(x),M=a(2),L=a.n(M),K=(a(65),a(25)),P=a.n(K),U=(a(60),a(12)),_=a.n(U),j=a(0),z=a.n(j),G=a(1),F=a.n(G),V=a(23),A=a(5),q=a.n(A),B=a(18),H=a(9),Q=a(1591),J=a(1716),W=a(1921),X=a(1918),Y=(a(1637),a(28)),Z=a(52);function $(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var ee=_.a.Item,te=P.a.confirm,ae=Z.a.getPermission()||[],ne=Object(V.b)("root")(n=Object(V.b)("authManage")(n=Object(V.c)((r=o=function(e){O()(n,e);var t,a=(t=n,function(){var e,a=I()(t);if($()){var n=I()(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return R()(this,e)});function n(e){var t;return k()(this,n),t=a.call(this,e),L()(C()(t),"reset",(function(){t.formRef.current.resetFields()})),L()(C()(t),"onClose",(function(){t.setState({showmodal:!1})})),L()(C()(t),"onFinish",(function(e){var a=t.state.operateType;if("see"!==a)if("add"===a)e.parId=t.key,t.setState({loading:!0}),B.a.post("".concat(BSS_ADMIN_URL,"/api/user/dept/add"),e).then((function(e){2e4==e.data.code?(t.onClose(),t.getOrgData(),v.a.success("新建机构成功"),t.setState({loading:!1})):(v.a.error(e.data.data),t.setState({loading:!1}))})).catch((function(e){v.a.error(e.data.data),t.setState({loading:!1})}));else{var n=t.node.id;e.parId=t.node.parId,e.version=t.state.version,t.setState({loading:!0}),B.a.put("".concat(BSS_ADMIN_URL,"/api/user/dept/").concat(n,"/update"),e).then((function(e){2e4==e.data.code?(t.getOrgData(),t.onClose(),v.a.success("修改机构成功"),t.setState({loading:!1})):(v.a.error(e.data.data),t.setState({loading:!1}))})).catch((function(e){v.a.error(e.data.data),t.setState({loading:!1})}))}else t.onClose()})),t.formRef=z.a.createRef(),t.key=[],t.nowDataKey=t.props.nowDataKey||Y.h.id,t.state={loading:!1,nowDataKey:t.props.nowDataKey||Y.h.id,showmodal:!1,modalLoading:!1,operateType:"see",treenode:[],listnode:[],nowData:{},listnode2:[],version:0,expand:[]},t}return D()(n,[{key:"componentDidMount",value:function(){this.getOrgData()}},{key:"getOrgData",value:function(){var e=this;if(this.setState({loading:!0}),"role"===this.props.type2){var t=q.a.assign({},{otherDept:0});this.props.authManage.getDeptLists(t).then((function(t){2e4==t.code&&e.setState({treenode:H.a.formatTree(t.data),listnode2:t.data}),e.setState({loading:!1})})).catch((function(t){e.setState({loading:!1})}))}else B.a.get("".concat(BSS_ADMIN_URL,"/api/user/dept")).then((function(t){2e4==t.data.code&&e.setState({treenode:H.a.formatTree(t.data.data),listnode:t.data.data}),e.setState({loading:!1})})).catch((function(t){e.setState({loading:!1})}))}},{key:"opt",value:function(e,t,a){this.node=t,this.key=e,this.setState({operateType:a,showmodal:!0,nowData:{id:t.id||"",name:t.name||""},version:t&&t.version})}},{key:"onDelOrg",value:function(e,t){this.props.type2;var a=this;te({title:"你确定要删除这个部门吗?",icon:z.a.createElement(Q.a,null),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){a.setState({loading:!0}),B.a.delete("".concat(BSS_ADMIN_URL,"/api/user/dept/").concat(e,"/delete")).then((function(e){2e4===e.data.code?(a.onClose(),v.a.success("删除成功"),a.getOrgData(),a.setState({loading:!1})):(v.a.error(e.data.data),a.setState({loading:!1}))})).catch((function(){a.setState({loading:!1}),v.a.error(res.data.data)}))},onCancel:function(){}})}},{key:"handleTreeState",value:function(e,t,a,n){if(event.preventDefault(),e.stopPropagation(),"current"===n){if(this.nowDataKey==t)return!1;var o=a.id===t;this.nowDataKey=o?t:this.nowDataKey,this.setState({nowDataKey:this.nowDataKey}),this.props.onQuery(t,a)}else if("role"===this.props.type2){var r=q.a.cloneDeep(this.state.listnode2),s=q.a.map(r,(function(e){return e.id===t?(e.isexpanded=null!=e.isexpanded&&!e.isexpanded,e):e}));this.setState({listnode2:s,treenode:H.a.formatTree(s)})}else{var i=q.a.cloneDeep(this.state.listnode),l=q.a.map(i,(function(e){return e.id===t?(e.isexpanded=null==e.isexpanded||!e.isexpanded,e):e}));this.setState({listnode:l,treenode:H.a.formatTree(l)})}}},{key:"makeTreeNode",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n="tree-node",o=e.children&&e.children.length>0;(void 0===e.isexpanded&&"0"==e.parId||e.isexpanded)&&(n+=" is-expanded"),this.state.nowDataKey==e.id&&(n+=" is-current");var r=z.a.createElement(y.a,{style:{width:"80px",textAlign:"center"}},z.a.createElement(y.a.Item,{key:"role"===this.props.type2?"1":"2",onClick:function(){t.opt(e.id,e,"see")}},z.a.createElement("span",null,"查看")),ae.includes("dept-add")&&z.a.createElement(y.a.Item,{key:"role"===this.props.type2?"3":"4",onClick:function(){t.opt(e.id,e,"add")}},z.a.createElement("span",null,"增加")),ae.includes("dept-edit")&&z.a.createElement(y.a.Item,{key:"role"===this.props.type2?"5":"6",onClick:function(){t.opt(e.id,e,"up")}},z.a.createElement("span",null,"修改")),ae.includes("dept-delete")&&z.a.createElement(y.a.Item,{key:"role"===this.props.type2?"7":"8",onClick:function(){t.onDelOrg(e.id,"delet")}},z.a.createElement("span",{style:{textAlign:"center"}},"删除")));return z.a.createElement("div",{role:"treeitem",className:n,key:e.id},z.a.createElement("div",{className:"tree-node_content is-focusable",style:{paddingLeft:16*a}},z.a.createElement("div",{className:"node-data"},z.a.createElement("span",{className:"node-label",onClick:function(a){t.handleTreeState(a,e.id,e,"expanded")}},(o&&!0===e.isexpanded||o&&void 0===e.isexpanded&&"0"==e.parId)&&z.a.createElement(J.a,{className:"expaned-icon"}),(o&&!1===e.isexpanded||o&&void 0===e.isexpanded&&"0"!=e.parId)&&z.a.createElement(W.a,{className:"expaned-icon"})),z.a.createElement("span",{id:e.id,onClick:function(a){t.handleTreeState(a,e.id,e,"current")},className:"node-label"},e.name),z.a.createElement("div",{className:"node-lable-opt"},z.a.createElement(f.a.Button,{disabled:"-1"===e.id,overlay:r,style:{top:"13px"},icon:z.a.createElement(X.a,{style:{color:"#3e82de",fontSize:"18px"}}),type:"link",placement:"bottomCenter"})))),o&&z.a.createElement("div",{role:"group",className:"tree-node_children",key:e.id},q.a.map(e.children,(function(e){return t.makeTreeNode(e,a+1)}))))}},{key:"render",value:function(){var e=this,t=this.state.treenode,a=this.state,n=a.operateType,o=a.loading,r=a.showmodal,s=a.modalLoading,l=a.nowData;return z.a.createElement(z.a.Fragment,null,o&&z.a.createElement(h.a,null),z.a.createElement("div",{className:"org-tree tree--highlight-current",role:"tree"},q.a.map(t,(function(t){return e.makeTreeNode(t)}))),z.a.createElement(P.a,{title:{add:"新增部门",up:"修改部门",see:"查看"}[n],maskClosable:!0,width:"50%",destroyOnClose:!0,onCancel:function(){e.onClose()},visible:r,confirmLoading:s,footer:null},z.a.createElement(_.a,{name:"form_in_modal",ref:this.formRef,initialValues:"add"===n?null:l,onFinish:function(t){e.onFinish(t)},className:"g-modal-field"},z.a.createElement(ee,c()({label:"部门名称",name:"name",rules:[{required:!0,message:"必填"},{max:16,message:"最多输入16位字符"}]},Y.b),z.a.createElement(u.a,{placeholder:"请输入部门名称",disabled:"see"===n})),z.a.createElement("div",{className:"actions-btn"},z.a.createElement(i.a,{htmlType:"submit",className:"action-btn ok",style:"see"===n?{display:"none"}:{display:"inline-block"}},"提交"),z.a.createElement(i.a,{htmlType:"reset",className:"action-btn ok",onClick:this.reset,style:"see"===n?{display:"none"}:{display:"inline-block"}},"重置"),z.a.createElement(i.a,{onClick:this.onClose,className:"action-btn ok"},"取消")))))}}]),n}(z.a.Component),L()(o,"propTypes",{onQuery:F.a.func,selectedOrgId:F.a.string}),n=r))||n)||n)||n;t.a=ne},1637:function(e,t,a){},1727:function(e,t,a){}}]);